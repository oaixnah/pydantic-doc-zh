# 使用 datamodel-code-generator 进行代码生成

[datamodel-code-generator](https://github.com/koxudaxi/datamodel-code-generator/) 项目是一个库和命令行工具，可以从几乎任何数据源生成 pydantic 模型，包括：

* OpenAPI 3 (YAML/JSON)
* JSON Schema
* JSON/YAML/CSV 数据（将被转换为 JSON Schema）
* Python 字典（将被转换为 JSON Schema）
* GraphQL 模式

当您遇到任何可转换为 JSON 但没有 pydantic 模型的数据时，此工具将允许您按需生成类型安全的模型层次结构。

## 安装

```bash
pip install datamodel-code-generator
```

## 示例

在这个例子中，datamodel-code-generator 从 JSON Schema 文件创建 pydantic 模型。

```bash
datamodel-codegen  --input person.json --input-file-type jsonschema --output model.py
```

person.json:

```json
{
  "$id": "person.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Person",
  "type": "object",
  "properties": {
    "first_name": {
      "type": "string",
      "description": "The person's first name."
    },
    "last_name": {
      "type": "string",
      "description": "The person's last name."
    },
    "age": {
      "description": "Age in years.",
      "type": "integer",
      "minimum": 0
    },
    "pets": {
      "type": "array",
      "items": [
        {
          "$ref": "#/definitions/Pet"
        }
      ]
    },
    "comment": {
      "type": "null"
    }
  },
  "required": [
      "first_name",
      "last_name"
  ],
  "definitions": {
    "Pet": {
      "properties": {
        "name": {
          "type": "string"
        },
        "age": {
          "type": "integer"
        }
      }
    }
  }
}
```

model.py:

```python {upgrade="skip" requires="3.10"}
# generated by datamodel-codegen:
#   filename:  person.json
#   timestamp: 2020-05-19T15:07:31+00:00
from __future__ import annotations

from typing import Any

from pydantic import BaseModel, Field, conint


class Pet(BaseModel):
    name: str | None = None
    age: int | None = None


class Person(BaseModel):
    first_name: str = Field(description="The person's first name.")
    last_name: str = Field(description="The person's last name.")
    age: conint(ge=0) | None = Field(None, description='Age in years.')
    pets: list[Pet] | None = None
    comment: Any | None = None
```

更多信息可以在
[官方文档](https://koxudaxi.github.io/datamodel-code-generator/)中找到