
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="支持从环境变量或密钥文件加载设置或配置类。">
      
      
      
        <link rel="canonical" href="https://docs.pydantic.dev/latest/concepts/pydantic_settings/">
      
      
        <link rel="prev" href="../conversion_table/">
      
      
        <link rel="next" href="../performance/">
      
      
      <link rel="icon" href="../../favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Settings Management - Pydantic Validation 中文文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra/terminal.css">
    
      <link rel="stylesheet" href="../../extra/tweaks.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0JG77H6XTZ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0JG77H6XTZ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-0JG77H6XTZ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1543086387751444" crossorigin="anonymous"></script>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "ttp8vaq845");
</script>


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Pydantic Validation 中文文档" class="md-header__button md-logo" aria-label="Pydantic Validation 中文文档" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydantic Validation 中文文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Settings Management
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pydantic/pydantic" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  快速开始

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../models/" class="md-tabs__link">
          
  
  
  概念

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/base_model/" class="md-tabs__link">
          
  
  
  API 参考

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../internals/architecture/" class="md-tabs__link">
          
  
  
  内部实现

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/files/" class="md-tabs__link">
          
  
  
  示例

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../errors/errors/" class="md-tabs__link">
          
  
  
  错误信息

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../integrations/logfire/" class="md-tabs__link">
          
  
  
  集成

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pydantic Validation 中文文档" class="md-nav__button md-logo" aria-label="Pydantic Validation 中文文档" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    Pydantic Validation 中文文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pydantic/pydantic" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    快速开始
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            快速开始
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to Pydantic
    
      <br>
      <small>欢迎使用 Pydantic</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../why/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why use Pydantic
    
      <br>
      <small>为什么使用 Pydantic</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help_with_pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Help with Pydantic
    
      <br>
      <small>获取帮助</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
      <br>
      <small>安装</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration Guide
    
      <br>
      <small>迁移指南</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../version-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Version Policy
    
      <br>
      <small>版本策略</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
      <br>
      <small>贡献</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    概念
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            概念
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serialization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../forward_annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forward Annotations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strict_mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strict Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../type_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Type Adapter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation_decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Decorator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conversion_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conversion Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Settings Management
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Settings Management
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      使用
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      默认值验证
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variable-names" class="md-nav__link">
    <span class="md-ellipsis">
      环境变量名称
    </span>
  </a>
  
    <nav class="md-nav" aria-label="环境变量名称">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      大小写敏感性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-environment-variable-values" class="md-nav__link">
    <span class="md-ellipsis">
      解析环境变量值
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解析环境变量值">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      禁用 JSON 解析
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套模型默认部分更新
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dotenv-env" class="md-nav__link">
    <span class="md-ellipsis">
      Dotenv (.env) 支持
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-support" class="md-nav__link">
    <span class="md-ellipsis">
      命令行支持
    </span>
  </a>
  
    <nav class="md-nav" aria-label="命令行支持">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      基础
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      字典
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      字面量和枚举
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      别名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      子命令和位置参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-cli-applications" class="md-nav__link">
    <span class="md-ellipsis">
      创建 CLI 应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      异步 CLI 命令
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异步 CLI 命令">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      异步子命令
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_1" class="md-nav__link">
    <span class="md-ellipsis">
      序列化 CLI 参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      互斥组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_2" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 CLI 体验
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 CLI 体验">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      更改显示的程序名称
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_3" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 布尔标志
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      忽略和检索未知参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-kebab-case" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 参数的 Kebab Case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_4" class="md-nav__link">
    <span class="md-ellipsis">
      更改 CLI 是否应在出错时退出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_5" class="md-nav__link">
    <span class="md-ellipsis">
      在 CLI 中强制执行必需参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#none" class="md-nav__link">
    <span class="md-ellipsis">
      更改 None 类型解析字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#none_1" class="md-nav__link">
    <span class="md-ellipsis">
      隐藏 None 类型值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-cli" class="md-nav__link">
    <span class="md-ellipsis">
      避免添加 JSON CLI 选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      使用类文档字符串作为组帮助文本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_6" class="md-nav__link">
    <span class="md-ellipsis">
      更改 CLI 标志前缀字符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_7" class="md-nav__link">
    <span class="md-ellipsis">
      从 CLI 帮助文本中抑制字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_8" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 参数快捷方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      与现有解析器集成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Secrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      用例：Docker Secrets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套密钥
    </span>
  </a>
  
    <nav class="md-nav" aria-label="嵌套密钥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      用例：普通目录布局
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      用例：嵌套目录布局
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      用例：多个嵌套目录
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      配置选项
    </span>
  </a>
  
    <nav class="md-nav" aria-label="配置选项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secrets_dir" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_dir_missing" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir_missing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_dir_max_size" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir_max_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_case_sensitive" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_case_sensitive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_nested_delimiter" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_nested_delimiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_nested_subdir" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_nested_subdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_prefix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-secrets-manager" class="md-nav__link">
    <span class="md-ellipsis">
      AWS Secrets Manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      Azure Key Vault
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure Key Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#snake-case" class="md-nav__link">
    <span class="md-ellipsis">
      Snake case 转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      破折号到下划线映射
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-secret-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud Secret Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud Secret Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      基本用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcp-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      GCP Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      重要注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      其他设置源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其他设置源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyprojecttoml" class="md-nav__link">
    <span class="md-ellipsis">
      pyproject.toml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-value-priority" class="md-nav__link">
    <span class="md-ellipsis">
      字段值优先级
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customise-settings-sources" class="md-nav__link">
    <span class="md-ellipsis">
      自定义设置源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义设置源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      更改优先级
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      添加源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="添加源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      访问先前源的结果
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      移除源
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      就地重载
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experimental/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experimental
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API 参考
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API 参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Pydantic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/base_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BaseModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/root_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RootModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/type_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TypeAdapter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/validate_call/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validate Call
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/aliases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aliases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/json_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Errors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/functional_validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Validators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/functional_serializers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Serializers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/standard_library_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Standard Library Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Version Information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/annotated_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Annotated Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/experimental/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experimental
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Pydantic Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic_core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_core_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic_core.core_schema
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic Extra Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Pydantic Extra Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_color/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Color
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_country/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Country
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_payment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_phone_numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phone Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_routing_numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_coordinate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coordinate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_mac_address/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac Address
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_isbn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ISBN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_pendulum_dt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pendulum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_currency_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Currency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_language_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_script_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Script Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_semantic_version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Semantic Version
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_timezone_name/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timezone Name
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    内部实现
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            内部实现
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internals/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
      <br>
      <small>架构</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internals/resolving_annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resolving Annotations
    
      <br>
      <small>解析注解</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    示例
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            示例
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validating File Data
    
      <br>
      <small>验证文件数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web and API Requests
    
      <br>
      <small>验证 HTTP 请求数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/queues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queues
    
      <br>
      <small>验证队列数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/orms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Databases
    
      <br>
      <small>验证 ORM 数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/custom_validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Validators
    
      <br>
      <small>自定义验证器</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    错误信息
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            错误信息
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling
    
      <br>
      <small>错误处理</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/validation_errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Errors
    
      <br>
      <small>验证错误</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/usage_errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Errors
    
      <br>
      <small>使用错误</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    集成
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            集成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/logfire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Logfire
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/llms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    开发工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            开发工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/mypy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mypy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pyrefly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyrefly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pycharm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyCharm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/hypothesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hypothesis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/visual_studio_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visual Studio Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/datamodel_code_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datamodel-code-generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/devtools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    devtools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/rich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rich
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/linting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    生产工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            生产工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/aws_lambda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Lambda
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      使用
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      默认值验证
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variable-names" class="md-nav__link">
    <span class="md-ellipsis">
      环境变量名称
    </span>
  </a>
  
    <nav class="md-nav" aria-label="环境变量名称">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      大小写敏感性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-environment-variable-values" class="md-nav__link">
    <span class="md-ellipsis">
      解析环境变量值
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解析环境变量值">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      禁用 JSON 解析
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套模型默认部分更新
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dotenv-env" class="md-nav__link">
    <span class="md-ellipsis">
      Dotenv (.env) 支持
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-support" class="md-nav__link">
    <span class="md-ellipsis">
      命令行支持
    </span>
  </a>
  
    <nav class="md-nav" aria-label="命令行支持">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      基础
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      字典
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      字面量和枚举
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      别名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      子命令和位置参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-cli-applications" class="md-nav__link">
    <span class="md-ellipsis">
      创建 CLI 应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      异步 CLI 命令
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异步 CLI 命令">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      异步子命令
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_1" class="md-nav__link">
    <span class="md-ellipsis">
      序列化 CLI 参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      互斥组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_2" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 CLI 体验
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 CLI 体验">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      更改显示的程序名称
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_3" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 布尔标志
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      忽略和检索未知参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-kebab-case" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 参数的 Kebab Case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_4" class="md-nav__link">
    <span class="md-ellipsis">
      更改 CLI 是否应在出错时退出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_5" class="md-nav__link">
    <span class="md-ellipsis">
      在 CLI 中强制执行必需参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#none" class="md-nav__link">
    <span class="md-ellipsis">
      更改 None 类型解析字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#none_1" class="md-nav__link">
    <span class="md-ellipsis">
      隐藏 None 类型值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-cli" class="md-nav__link">
    <span class="md-ellipsis">
      避免添加 JSON CLI 选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      使用类文档字符串作为组帮助文本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_6" class="md-nav__link">
    <span class="md-ellipsis">
      更改 CLI 标志前缀字符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_7" class="md-nav__link">
    <span class="md-ellipsis">
      从 CLI 帮助文本中抑制字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli_8" class="md-nav__link">
    <span class="md-ellipsis">
      CLI 参数快捷方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      与现有解析器集成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Secrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      用例：Docker Secrets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套密钥
    </span>
  </a>
  
    <nav class="md-nav" aria-label="嵌套密钥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      用例：普通目录布局
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      用例：嵌套目录布局
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      用例：多个嵌套目录
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      配置选项
    </span>
  </a>
  
    <nav class="md-nav" aria-label="配置选项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secrets_dir" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_dir_missing" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir_missing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_dir_max_size" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_dir_max_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_case_sensitive" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_case_sensitive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_nested_delimiter" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_nested_delimiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_nested_subdir" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_nested_subdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      secrets_prefix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-secrets-manager" class="md-nav__link">
    <span class="md-ellipsis">
      AWS Secrets Manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      Azure Key Vault
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure Key Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#snake-case" class="md-nav__link">
    <span class="md-ellipsis">
      Snake case 转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      破折号到下划线映射
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-secret-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud Secret Manager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud Secret Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      基本用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcp-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      GCP Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      重要注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      其他设置源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其他设置源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyprojecttoml" class="md-nav__link">
    <span class="md-ellipsis">
      pyproject.toml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-value-priority" class="md-nav__link">
    <span class="md-ellipsis">
      字段值优先级
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customise-settings-sources" class="md-nav__link">
    <span class="md-ellipsis">
      自定义设置源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义设置源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      更改优先级
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      添加源
    </span>
  </a>
  
    <nav class="md-nav" aria-label="添加源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      访问先前源的结果
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      移除源
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      就地重载
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">设置管理<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/pydantic/pydantic-settings">Pydantic Settings</a> 提供了可选的 Pydantic 功能，用于从环境变量或密钥文件加载设置或配置类。</p>
<h2 id="_2">安装<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>安装非常简单：</p>
<div class="language-bash highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pydantic-settings
</code></pre></div>
<h2 id="_3">使用<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>如果你创建一个继承自 <code>BaseSettings</code> 的模型，模型初始化器将尝试通过从环境中读取来确定任何未作为关键字参数传递的字段的值。（如果未设置匹配的环境变量，仍将使用默认值。）</p>
<p>这使得以下操作变得容易：</p>
<ul>
<li>创建一个明确定义、类型提示的应用程序配置类</li>
<li>自动从环境变量中读取配置的修改</li>
<li>在需要时手动覆盖初始化器中的特定设置（例如在单元测试中）</li>
</ul>
<p>例如：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AliasChoices</span><span class="p">,</span>
    <span class="n">AmqpDsn</span><span class="p">,</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">,</span>
    <span class="n">ImportString</span><span class="p">,</span>
    <span class="n">PostgresDsn</span><span class="p">,</span>
    <span class="n">RedisDsn</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="n">apple</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">auth_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">validation_alias</span><span class="o">=</span><span class="s1">&#39;my_auth_key&#39;</span><span class="p">)</span>  <span class="c1"># (1)!</span>

    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;my_api_key&#39;</span><span class="p">)</span>  <span class="c1"># (2)!</span>

    <span class="n">redis_dsn</span><span class="p">:</span> <span class="n">RedisDsn</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="s1">&#39;redis://user:pass@localhost:6379/1&#39;</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="n">AliasChoices</span><span class="p">(</span><span class="s1">&#39;service_redis_dsn&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_url&#39;</span><span class="p">),</span>  <span class="c1"># (3)!</span>
    <span class="p">)</span>
    <span class="n">pg_dsn</span><span class="p">:</span> <span class="n">PostgresDsn</span> <span class="o">=</span> <span class="s1">&#39;postgres://user:pass@localhost:5432/foobar&#39;</span>
    <span class="n">amqp_dsn</span><span class="p">:</span> <span class="n">AmqpDsn</span> <span class="o">=</span> <span class="s1">&#39;amqp://user:pass@localhost:5672/&#39;</span>

    <span class="n">special_function</span><span class="p">:</span> <span class="n">ImportString</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;math.cos&#39;</span>  <span class="c1"># (4)!</span>

    <span class="c1"># to override domains:</span>
    <span class="c1"># export my_prefix_domains=&#39;[&quot;foo.com&quot;, &quot;bar.com&quot;]&#39;</span>
    <span class="n">domains</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># to override more_settings:</span>
    <span class="c1"># export my_prefix_more_settings=&#39;{&quot;foo&quot;: &quot;x&quot;, &quot;apple&quot;: 1}&#39;</span>
    <span class="n">more_settings</span><span class="p">:</span> <span class="n">SubModel</span> <span class="o">=</span> <span class="n">SubModel</span><span class="p">()</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;my_prefix_&#39;</span><span class="p">)</span>  <span class="c1"># (5)!</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;auth_key&#39;: &#39;xxx&#39;,</span>
<span class="sd">    &#39;api_key&#39;: &#39;xxx&#39;,</span>
<span class="sd">    &#39;redis_dsn&#39;: RedisDsn(&#39;redis://user:pass@localhost:6379/1&#39;),</span>
<span class="sd">    &#39;pg_dsn&#39;: PostgresDsn(&#39;postgres://user:pass@localhost:5432/foobar&#39;),</span>
<span class="sd">    &#39;amqp_dsn&#39;: AmqpDsn(&#39;amqp://user:pass@localhost:5672/&#39;),</span>
<span class="sd">    &#39;special_function&#39;: math.cos,</span>
<span class="sd">    &#39;domains&#39;: set(),</span>
<span class="sd">    &#39;more_settings&#39;: {&#39;foo&#39;: &#39;bar&#39;, &#39;apple&#39;: 1},</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<ol>
<li>
<p>使用 <code>validation_alias</code> 覆盖环境变量名称。在这种情况下，将读取环境变量 <code>my_auth_key</code> 而不是 <code>auth_key</code>。</p>
<p>查看 <a href="../fields/"><code>Field</code> 文档</a> 获取更多信息。</p>
</li>
<li>
<p>使用 <code>alias</code> 覆盖环境变量名称。在这种情况下，环境变量 <code>my_api_key</code> 将用于验证和序列化，而不是 <code>api_key</code>。</p>
<p>查看 <a href="../fields/#field-aliases"><code>Field</code> 文档</a> 获取更多信息。</p>
</li>
<li>
<p><a class="autorefs autorefs-internal" href="../../api/aliases/#pydantic.aliases.AliasChoices"><code>AliasChoices</code></a> 类允许为单个字段设置多个环境变量名称。将使用找到的第一个环境变量。</p>
<p>查看 <a href="../alias/#aliaspath-and-aliaschoices">别名选择文档</a> 获取更多信息。</p>
</li>
<li>
<p><a class="autorefs autorefs-internal" href="../../api/types/#pydantic.types.ImportString"><code>ImportString</code></a> 类允许从字符串导入对象。
   在这种情况下，将读取环境变量 <code>special_function</code> 并导入函数 <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/math.html#math.cos"><code>math.cos</code></a>。</p>
</li>
<li>
<p><code>env_prefix</code> 配置设置允许为所有环境变量设置前缀。</p>
<p>查看 <a href="#environment-variable-names">环境变量名称文档</a> 获取更多信息。</p>
</li>
</ol>
<h2 id="_4">默认值验证<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>与 pydantic <code>BaseModel</code> 不同，<code>BaseSettings</code> 字段的默认值默认会被验证。
你可以通过在 <code>model_config</code> 中设置 <code>validate_default=False</code> 或在字段级别通过 <code>Field(validate_default=False)</code> 来禁用此行为：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">validate_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># 默认值不会被验证</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">())</span>
<span class="c1">#&gt; foo=&#39;test&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings1</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="c1"># 默认值不会被验证</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">validate_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings1</span><span class="p">())</span>
<span class="c1">#&gt; foo=&#39;test&#39;</span>
</code></pre></div>
<p>查看 <a href="../fields/#validate-default-values">默认值验证</a> 获取更多信息。</p>
<h2 id="environment-variable-names">环境变量名称<a class="headerlink" href="#environment-variable-names" title="Permanent link">&para;</a></h2>
<p>默认情况下，环境变量名称与字段名称相同。</p>
<p>你可以通过设置 <code>env_prefix</code> 配置设置或在实例化时通过 <code>_env_prefix</code> 关键字参数来更改所有环境变量的前缀：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;my_prefix_&#39;</span><span class="p">)</span>

    <span class="n">auth_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;xxx&#39;</span>  <span class="c1"># 将从 `my_prefix_auth_key` 读取</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>默认的 <code>env_prefix</code> 是 <code>''</code>（空字符串）。<code>env_prefix</code> 不仅适用于环境设置，还适用于
dotenv 文件、密钥和其他源。</p>
</div>
<p>如果你想更改单个字段的环境变量名称，可以使用别名。</p>
<p>有两种方法可以做到这一点：</p>
<ul>
<li>使用 <code>Field(alias=...)</code>（参见上面的 <code>api_key</code>）</li>
<li>使用 <code>Field(validation_alias=...)</code>（参见上面的 <code>auth_key</code>）</li>
</ul>
<p>查看 <a href="../fields/#field-aliases"><code>Field</code> 别名文档</a> 获取有关别名的更多信息。</p>
<p><code>env_prefix</code> 不适用于带有别名的字段。这意味着环境变量名称与字段别名相同：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;my_prefix_&#39;</span><span class="p">)</span>

    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s1">&#39;FooAlias&#39;</span><span class="p">)</span>  <span class="c1"># (1)!</span>
</code></pre></div>
<ol>
<li><code>env_prefix</code> 将被忽略，值将从 <code>FooAlias</code> 环境变量中读取。</li>
</ol>
<h3 id="_5">大小写敏感性<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>默认情况下，环境变量名称是大小写不敏感的。</p>
<p>如果你想使环境变量名称大小写敏感，可以设置 <code>case_sensitive</code> 配置设置：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">redis_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
</code></pre></div>
<p>当 <code>case_sensitive</code> 为 <code>True</code> 时，环境变量名称必须与字段名称匹配（可选地带有前缀），
因此在此示例中，<code>redis_host</code> 只能通过 <code>export redis_host</code> 进行修改。如果你想将环境变量命名为全大写，
你也应该将属性命名为全大写。你仍然可以通过 <code>Field(validation_alias=...)</code> 将环境变量命名为任何你喜欢的名称。</p>
<p>大小写敏感性也可以通过实例化时的 <code>_case_sensitive</code> 关键字参数设置。</p>
<p>对于嵌套模型，<code>case_sensitive</code> 设置将应用于所有嵌套模型。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RedisSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">redis</span><span class="p">:</span> <span class="n">RedisSettings</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;redis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&quot;host&quot;: &quot;localhost&quot;, &quot;port&quot;: 6379}&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;redis&#39;: {&#39;host&#39;: &#39;localhost&#39;, &#39;port&#39;: 6379}}</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;redis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{&quot;HOST&quot;: &quot;localhost&quot;, &quot;port&quot;: 6379}&#39;</span>  <span class="c1"># (1)!</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for Settings</span>
<span class="sd">    redis.host</span>
<span class="sd">      Field required [type=missing, input_value={&#39;HOST&#39;: &#39;localhost&#39;, &#39;port&#39;: 6379}, input_type=dict]</span>
<span class="sd">        有关更多信息，请访问 https://errors.pydantic.dev/2/v/missing</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<ol>
<li>注意 <code>host</code> 字段未找到，因为环境变量名称是 <code>HOST</code>（全大写）。</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在 Windows 上，Python 的 <code>os</code> 模块始终将环境变量视为大小写不敏感，因此
<code>case_sensitive</code> 配置设置将无效 - 设置将始终忽略大小写进行更新。</p>
</div>
<h2 id="parsing-environment-variable-values">解析环境变量值<a class="headerlink" href="#parsing-environment-variable-values" title="Permanent link">&para;</a></h2>
<p>默认情况下，环境变量按字面解析，包括值为空的情况。你可以通过将 <code>env_ignore_empty</code> 配置设置设置为 <code>True</code> 来选择忽略空环境变量。
如果你更愿意使用字段的默认值而不是来自环境的空值，这会很有用。</p>
<p>对于大多数简单字段类型（如 <code>int</code>、<code>float</code>、<code>str</code> 等），环境变量值的解析方式与直接传递给初始化器（作为字符串）相同。</p>
<p>复杂类型如 <code>list</code>、<code>set</code>、<code>dict</code> 和子模型通过将环境变量的值视为 JSON 编码的字符串来从环境中填充。</p>
<p>填充嵌套复杂变量的另一种方法是配置模型的 <code>env_nested_delimiter</code> 配置设置，然后使用指向嵌套模块字段名称的环境变量。
它的作用只是将你的变量分解为嵌套模型或字典。
因此，如果你定义一个变量 <code>FOO__BAR__BAZ=123</code>，它将转换为 <code>FOO={'BAR': {'BAZ': 123}}</code>
如果你有多个具有相同结构的变量，它们将被合并。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>子模型必须继承自 <code>pydantic.BaseModel</code>，否则 <code>pydantic-settings</code> 将初始化子模型，
单独收集子模型字段的值，你可能会得到意外的结果。</p>
</div>
<p>例如，给定以下环境变量：
<div class="language-bash highlight"><pre><span></span><code><span class="c1"># your environment</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">V0</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SUB_MODEL</span><span class="o">=</span><span class="s1">&#39;{&quot;v1&quot;: &quot;json-1&quot;, &quot;v2&quot;: &quot;json-2&quot;}&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SUB_MODEL__V2</span><span class="o">=</span>nested-2
<span class="nb">export</span><span class="w"> </span><span class="nv">SUB_MODEL__V3</span><span class="o">=</span><span class="m">3</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SUB_MODEL__DEEP__V4</span><span class="o">=</span>v4
</code></pre></div></p>
<p>你可以将它们加载到以下设置模型中：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DeepSubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>  <span class="c1"># (1)!</span>
    <span class="n">v4</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>  <span class="c1"># (2)!</span>
    <span class="n">v1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">v2</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">v3</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">deep</span><span class="p">:</span> <span class="n">DeepSubModel</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>

    <span class="n">v0</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sub_model</span><span class="p">:</span> <span class="n">SubModel</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;v0&#39;: &#39;0&#39;,</span>
<span class="sd">    &#39;sub_model&#39;: {&#39;v1&#39;: &#39;json-1&#39;, &#39;v2&#39;: b&#39;nested-2&#39;, &#39;v3&#39;: 3, &#39;deep&#39;: {&#39;v4&#39;: &#39;v4&#39;}},</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<ol>
<li>
<p>子模型必须继承自 <code>pydantic.BaseModel</code>。</p>
</li>
<li>
<p>子模型必须继承自 <code>pydantic.BaseModel</code>。</p>
</li>
</ol>
<p><code>env_nested_delimiter</code> 可以通过 <code>model_config</code> 配置，如上所示，也可以通过实例化时的 <code>_env_nested_delimiter</code> 关键字参数配置。</p>
<p>默认情况下，环境变量按 <code>env_nested_delimiter</code> 分割为任意深度的嵌套字段。你可以使用 <code>env_nested_max_split</code> 配置设置限制嵌套字段的深度。这在两级深度设置中特别有用，其中 <code>env_nested_delimiter</code>（通常是单个 <code>_</code>）可能是模型字段名称的子字符串。例如：</p>
<div class="language-bash highlight"><pre><span></span><code><span class="c1"># your environment</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GENERATION_LLM_PROVIDER</span><span class="o">=</span><span class="s1">&#39;anthropic&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GENERATION_LLM_API_KEY</span><span class="o">=</span><span class="s1">&#39;your-api-key&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GENERATION_LLM_API_VERSION</span><span class="o">=</span><span class="s1">&#39;2024-03-15&#39;</span>
</code></pre></div>
<p>你可以将它们加载到以下设置模型中：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LLMConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;openai&#39;</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">api_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;azure&#39;</span>
    <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;2023-03-15-preview&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">GenerationConfig</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">env_nested_max_split</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;GENERATION_&#39;</span>
    <span class="p">)</span>

    <span class="n">llm</span><span class="p">:</span> <span class="n">LLMConfig</span>
    <span class="o">...</span>


<span class="nb">print</span><span class="p">(</span><span class="n">GenerationConfig</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;llm&#39;: {</span>
<span class="sd">        &#39;provider&#39;: &#39;anthropic&#39;,</span>
<span class="sd">        &#39;api_key&#39;: &#39;your-api-key&#39;,</span>
<span class="sd">        &#39;api_type&#39;: &#39;azure&#39;,</span>
<span class="sd">        &#39;api_version&#39;: &#39;2024-03-15&#39;,</span>
<span class="sd">    }</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>如果没有设置 <code>env_nested_max_split=1</code>，<code>GENERATION_LLM_API_KEY</code> 将被解析为 <code>llm.api.key</code> 而不是 <code>llm.api_key</code>，并且会引发 <code>ValidationError</code>。</p>
<p>嵌套环境变量优先于顶级环境变量 JSON（例如，在上面的示例中，<code>SUB_MODEL__V2</code> 优先于 <code>SUB_MODEL</code>）。</p>
<p>你也可以通过提供自己的源类来填充复杂类型。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldInfo</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">EnvSettingsSource</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomSource</span><span class="p">(</span><span class="n">EnvSettingsSource</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_field_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldInfo</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value_is_complex</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;numbers&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">numbers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">MyCustomSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">),)</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1,2,3&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;numbers&#39;: [1, 2, 3]}</span>
</code></pre></div>
<h3 id="json">禁用 JSON 解析<a class="headerlink" href="#json" title="Permanent link">&para;</a></h3>
<p>pydantic-settings 默认将环境变量中的复杂类型解析为 JSON 字符串。如果你想禁用
此行为并在自己的验证器中解析值，可以使用 <a href="../../api/pydantic_settings/#pydantic_settings.NoDecode"><code>NoDecode</code></a> 注解字段：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">field_validator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">NoDecode</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">numbers</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">NoDecode</span><span class="p">]</span>  <span class="c1"># (1)!</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decode_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1,2,3&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;numbers&#39;: [1, 2, 3]}</span>
</code></pre></div>
<ol>
<li><code>NoDecode</code> 注解禁用 <code>numbers</code> 字段的 JSON 解析。<code>decode_numbers</code> 字段验证器将被调用来解析值。</li>
</ol>
<p>你也可以通过将 <code>enable_decoding</code> 配置设置设置为 <code>False</code> 来禁用所有字段的 JSON 解析：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">field_validator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">enable_decoding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">numbers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decode_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1,2,3&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;numbers&#39;: [1, 2, 3]}</span>
</code></pre></div>
<p>你可以通过使用 <a href="../../api/pydantic_settings/#pydantic_settings.ForceDecode"><code>ForceDecode</code></a> 注解字段来强制进行 JSON 解析。
这将绕过 <code>enable_decoding</code> 配置设置：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">field_validator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">ForceDecode</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">enable_decoding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">numbers</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">ForceDecode</span><span class="p">]</span>
    <span class="n">numbers1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># (1)!</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;numbers1&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decode_numbers1</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;numbers1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1,2,3&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;numbers&#39;: [1, 2, 3], &#39;numbers1&#39;: [1, 2, 3]}</span>
</code></pre></div>
<ol>
<li><code>numbers1</code> 字段没有用 <code>ForceDecode</code> 注解，因此不会被解析为 JSON，我们需要提供一个自定义验证器来解析值。</li>
</ol>
<h2 id="_6">嵌套模型默认部分更新<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>默认情况下，Pydantic settings 不允许对嵌套模型默认对象进行部分更新。可以通过将 <code>nested_model_default_partial_update</code> 标志设置为 <code>True</code> 来覆盖此行为，这将允许对嵌套模型默认对象字段进行部分更新。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SettingsPartialUpdate</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="n">nested_model_default_partial_update</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">nested_model</span><span class="p">:</span> <span class="n">SubModel</span> <span class="o">=</span> <span class="n">SubModel</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SettingsNoPartialUpdate</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="n">nested_model_default_partial_update</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">nested_model</span><span class="p">:</span> <span class="n">SubModel</span> <span class="o">=</span> <span class="n">SubModel</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># Apply a partial update to the default object using environment variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NESTED_MODEL__FLAG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>

<span class="c1"># When partial update is enabled, the existing SubModel instance is updated</span>
<span class="c1"># with nested_model.flag=True change</span>
<span class="k">assert</span> <span class="n">SettingsPartialUpdate</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;nested_model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># When partial update is disabled, a new SubModel instance is instantiated</span>
<span class="c1"># with nested_model.flag=True change</span>
<span class="k">assert</span> <span class="n">SettingsNoPartialUpdate</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;nested_model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="dotenv-env">Dotenv (.env) 支持<a class="headerlink" href="#dotenv-env" title="Permanent link">&para;</a></h2>
<p>Dotenv 文件（通常命名为 <code>.env</code>）是一种常见模式，可以轻松地以平台无关的方式使用环境变量。</p>
<p>Dotenv 文件遵循所有环境变量的相同一般原则，它看起来像这样：</p>
<div class="language-bash highlight"><span class="filename">.env</span><pre><span></span><code><span class="c1"># 忽略注释</span>
<span class="nv">ENVIRONMENT</span><span class="o">=</span><span class="s2">&quot;production&quot;</span>
<span class="nv">REDIS_ADDRESS</span><span class="o">=</span>localhost:6379
<span class="nv">MEANING_OF_LIFE</span><span class="o">=</span><span class="m">42</span>
<span class="nv">MY_VAR</span><span class="o">=</span><span class="s1">&#39;Hello world&#39;</span>
</code></pre></div>
<p>一旦你填充了 <code>.env</code> 文件，<em>pydantic</em> 支持以两种方式加载它：</p>
<ol>
<li>在 <code>BaseSettings</code> 类的 <code>model_config</code> 上设置 <code>env_file</code>（如果不想使用操作系统的默认编码，还可以设置 <code>env_file_encoding</code>）：
   <div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="hll"><span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
</span><span class="hll">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">env_file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></code></pre></div></li>
<li>使用 <code>_env_file</code> 关键字参数（如果需要，还可以使用 <code>_env_file_encoding</code>）实例化 <code>BaseSettings</code> 派生类：
   <div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">env_file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>


<span class="hll"><span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">_env_file</span><span class="o">=</span><span class="s1">&#39;prod.env&#39;</span><span class="p">,</span> <span class="n">_env_file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></code></pre></div>
无论哪种情况，传递的参数值可以是任何有效的路径或文件名，可以是绝对路径，也可以是相对于当前工作目录的路径。
从那里，<em>pydantic</em> 将通过加载你的变量并验证它们来处理所有事情。</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果为 <code>env_file</code> 指定了文件名，Pydantic 将仅检查当前工作目录，
不会检查任何父目录中的 <code>.env</code> 文件。</p>
</div>
<p>即使使用 dotenv 文件，<em>pydantic</em> 仍会读取环境变量以及 dotenv 文件，
<strong>环境变量始终优先于从 dotenv 文件加载的值</strong>。</p>
<p>通过实例化时的 <code>_env_file</code> 关键字参数传递文件路径（方法 2）将覆盖
<code>model_config</code> 类上设置的任何值。如果上述代码片段一起使用，将加载 <code>prod.env</code>
而忽略 <code>.env</code>。</p>
<p>如果需要加载多个 dotenv 文件，可以将多个文件路径作为元组或列表传递。文件将
按顺序加载，每个文件覆盖前一个文件。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="c1"># `.env.prod` 优先于 `.env`</span>
        <span class="n">env_file</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="s1">&#39;.env.prod&#39;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
<p>你也可以使用关键字参数覆盖来告诉 Pydantic 根本不加载任何文件（即使在
<code>model_config</code> 类中设置了文件），通过传递 <code>None</code> 作为实例化关键字参数，例如 <code>settings = Settings(_env_file=None)</code>。</p>
<p>由于使用 python-dotenv 来解析文件，可以使用类似 bash 的语义，如 <code>export</code>，
（取决于你的操作系统和环境）可能允许你的 dotenv 文件也与 <code>source</code> 一起使用，
有关更多详细信息，请参阅 <a href="https://saurabh-kumar.com/python-dotenv/#usages">python-dotenv 的文档</a>。</p>
<p>Pydantic settings 在 dotenv 文件的情况下会考虑 <code>extra</code> 配置。这意味着如果你在 <code>model_config</code> 上设置 <code>extra=forbid</code>（<em>默认</em>）
并且你的 dotenv 文件包含未在设置模型中定义的字段的条目，
它将在设置构造时引发 <code>ValidationError</code>。</p>
<p>为了与 pydantic 1.x BaseSettings 兼容，你应该使用 <code>extra=ignore</code>：
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pydantic settings 从 dotenv 文件加载所有值并将其传递给模型，无论模型的 <code>env_prefix</code> 如何。
因此，如果你在 dotenv 文件中提供额外值，无论它们是否以 <code>env_prefix</code> 开头，
都会引发 <code>ValidationError</code>。</p>
</div>
<h2 id="command-line-support">命令行支持<a class="headerlink" href="#command-line-support" title="Permanent link">&para;</a></h2>
<p>Pydantic settings 提供集成的 CLI 支持，使得使用 Pydantic 模型快速定义 CLI 应用程序变得容易。
Pydantic settings CLI 有两个主要用例：</p>
<ol>
<li>使用 CLI 覆盖 Pydantic 模型中的字段。</li>
<li>使用 Pydantic 模型定义 CLI。</li>
</ol>
<p>默认情况下，体验是针对用例 #1 量身定制的，并建立在 <a href="#parsing-environment-variable-values">解析环境变量</a> 中建立的基础上。
如果你的用例主要属于 #2，你可能希望启用 <a href="#creating-cli-applications">创建 CLI 应用程序</a> 末尾概述的大多数默认设置。</p>
<h3 id="_7">基础<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>开始之前，让我们重新审视 <a href="#parsing-environment-variable-values">解析环境变量</a> 中提供的示例，但使用 Pydantic settings CLI：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DeepSubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">v4</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">v1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">v2</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">v3</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">deep</span><span class="p">:</span> <span class="n">DeepSubModel</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">v0</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sub_model</span><span class="p">:</span> <span class="n">SubModel</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;example.py&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--v0=0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--sub_model={&quot;v1&quot;: &quot;json-1&quot;, &quot;v2&quot;: &quot;json-2&quot;}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--sub_model.v2=nested-2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--sub_model.v3=3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--sub_model.deep.v4=v4&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;v0&#39;: &#39;0&#39;,</span>
<span class="sd">    &#39;sub_model&#39;: {&#39;v1&#39;: &#39;json-1&#39;, &#39;v2&#39;: b&#39;nested-2&#39;, &#39;v3&#39;: 3, &#39;deep&#39;: {&#39;v4&#39;: &#39;v4&#39;}},</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>要启用 CLI 解析，我们只需将 <code>cli_parse_args</code> 标志设置为有效值，这保留了与
<code>argparse</code> 中定义的兼容性。</p>
<p>请注意，CLI 设置源默认是 <a href="#field-value-priority"><strong>最高优先级的源</strong></a>，除非其 <a href="#customise-settings-sources">优先级值被自定义</a>：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">CliSettingsSource</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">my_foo</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">env_settings</span><span class="p">,</span> <span class="n">CliSettingsSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MY_FOO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from environment&#39;</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_foo=from cli&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_foo&#39;: &#39;from environment&#39;}</span>
</code></pre></div>
<h4 id="_8">列表<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p>CLI 参数解析列表支持混合使用以下三种样式中的任何一种：</p>
<ul>
<li>JSON 样式 <code>--field='[1,2]'</code></li>
<li>Argparse 样式 <code>--field 1 --field 2</code></li>
<li>懒人样式 <code>--field=1,2</code></li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">my_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_list&#39;</span><span class="p">,</span> <span class="s1">&#39;[1,2]&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_list&#39;: [1, 2]}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_list&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_list&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_list&#39;: [1, 2]}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_list&#39;</span><span class="p">,</span> <span class="s1">&#39;1,2&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_list&#39;: [1, 2]}</span>
</code></pre></div>
<h4 id="_9">字典<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>CLI 参数解析字典支持混合使用以下两种样式中的任何一种：</p>
<ul>
<li>JSON 样式 <code>--field='{"k1": 1, "k2": 2}'</code></li>
<li>环境变量样式 <code>--field k1=1 --field k2=2</code></li>
</ul>
<p>这些也可以与列表形式结合使用，例如：</p>
<ul>
<li><code>--field k1=1,k2=2 --field k3=3 --field '{"k4": 4}'</code> 等</li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">my_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;{&quot;k1&quot;:1,&quot;k2&quot;:2}&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_dict&#39;: {&#39;k1&#39;: 1, &#39;k2&#39;: 2}}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;k1=1&#39;</span><span class="p">,</span> <span class="s1">&#39;--my_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;k2=2&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_dict&#39;: {&#39;k1&#39;: 1, &#39;k2&#39;: 2}}</span>
</code></pre></div>
<h4 id="_10">字面量和枚举<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>CLI 参数解析字面量和枚举会被转换为 CLI 选项。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntEnum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Fruit</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">pear</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">kiwi</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">lime</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">fruit</span><span class="p">:</span> <span class="n">Fruit</span>
    <span class="n">pet</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;bird&#39;</span><span class="p">]</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--fruit&#39;</span><span class="p">,</span> <span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="s1">&#39;--pet&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;fruit&#39;: &lt;Fruit.lime: 2&gt;, &#39;pet&#39;: &#39;cat&#39;}</span>
</code></pre></div>
<h4 id="_11">别名<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>Pydantic 字段别名会作为 CLI 参数别名添加。长度为1的别名会被转换为短选项。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">AliasChoices</span><span class="p">,</span> <span class="n">AliasPath</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="n">AliasChoices</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="n">AliasPath</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="n">AliasChoices</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;lname&#39;</span><span class="p">,</span> <span class="n">AliasPath</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--fname&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;--lname&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">User</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;first_name&#39;: &#39;John&#39;, &#39;last_name&#39;: &#39;Doe&#39;}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">User</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;first_name&#39;: &#39;John&#39;, &#39;last_name&#39;: &#39;Doe&#39;}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;John,Doe&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">User</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;first_name&#39;: &#39;John&#39;, &#39;last_name&#39;: &#39;Doe&#39;}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;--lname&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">User</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;first_name&#39;: &#39;John&#39;, &#39;last_name&#39;: &#39;Doe&#39;}</span>
</code></pre></div>
<h3 id="_12">子命令和位置参数<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>子命令和位置参数使用 <code>CliSubCommand</code> 和 <code>CliPositionalArg</code> 注解来表示。
子命令注解只能应用于必需字段（即没有默认值的字段）。
此外，子命令必须是派生自 pydantic <code>BaseModel</code> 或 pydantic.dataclasses <code>dataclass</code> 的有效类型。</p>
<p>解析后的子命令可以使用 <code>get_subcommand</code> 实用函数从模型实例中检索。如果子命令不是必需的，将 <code>is_required</code> 标志设置为 <code>False</code> 以在未找到子命令时禁用错误抛出。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CLI 设置子命令每个模型仅限于单个子解析器。换句话说，模型的所有子命令都分组在单个子解析器下；它不允许每个子解析器拥有自己的子命令集的多个子解析器。有关子解析器的更多信息，请参阅 <a href="https://docs.python.org/3/library/argparse.html#sub-commands">argparse 子命令</a>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>CliSubCommand</code> 和 <code>CliPositionalArg</code> 始终区分大小写。</p>
</div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">CliPositionalArg</span><span class="p">,</span>
    <span class="n">CliSubCommand</span><span class="p">,</span>
    <span class="n">SettingsError</span><span class="p">,</span>
    <span class="n">get_subcommand</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Init</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Clone</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">repository</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Git</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_exit_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">clone</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Clone</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Init</span><span class="p">]</span>


<span class="c1"># Run without subcommands</span>
<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">]</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">Git</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">cmd</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;clone&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Will raise an error since no subcommand was provided</span>
    <span class="n">get_subcommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<span class="k">except</span> <span class="n">SettingsError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Error: CLI subcommand is required {clone, init}&#39;</span>

<span class="c1"># Will not raise an error since subcommand is not required</span>
<span class="k">assert</span> <span class="n">get_subcommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">is_required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>


<span class="c1"># Run the clone subcommand</span>
<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;clone&#39;</span><span class="p">,</span> <span class="s1">&#39;repo&#39;</span><span class="p">,</span> <span class="s1">&#39;dest&#39;</span><span class="p">]</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">Git</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">cmd</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;clone&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;repository&#39;</span><span class="p">:</span> <span class="s1">&#39;repo&#39;</span><span class="p">,</span> <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;dest&#39;</span><span class="p">},</span>
    <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Returns the subcommand model instance (in this case, &#39;clone&#39;)</span>
<span class="k">assert</span> <span class="n">get_subcommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;dest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;repository&#39;</span><span class="p">:</span> <span class="s1">&#39;repo&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p><code>CliSubCommand</code> 和 <code>CliPositionalArg</code> 注解也支持联合操作和别名。对于 Pydantic 模型的联合，重要的是要记住验证过程中可能出现的 <a href="https://docs.pydantic.dev/latest/concepts/unions/">细微差别</a>。具体来说，对于内容相同的子命令联合，建议将它们分解为单独的 <code>CliSubCommand</code> 字段以避免任何复杂性。最后，从联合派生的子命令名称将是 Pydantic 模型类本身的名称。</p>
<p>当为 <code>CliSubCommand</code> 或 <code>CliPositionalArg</code> 字段分配别名时，只能分配单个别名。对于非联合子命令，别名将更改显示的帮助文本和子命令名称。相反，对于联合子命令，从 CLI 设置源的角度来看，别名不会有实际效果。最后，对于位置参数，别名将更改字段显示的 CLI 帮助文本。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">CliPositionalArg</span><span class="p">,</span>
    <span class="n">CliSubCommand</span><span class="p">,</span>
    <span class="n">get_subcommand</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Alpha</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apha Help&quot;&quot;&quot;</span>

    <span class="n">cmd_alpha</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;alpha-cmd&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Beta</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Beta Help&quot;&quot;&quot;</span>

    <span class="n">opt_beta</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;opt-beta&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Gamma</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gamma Help&quot;&quot;&quot;</span>

    <span class="n">opt_gamma</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;opt-gamma&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Root</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_exit_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">alpha_or_beta</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Alpha</span><span class="p">,</span> <span class="n">Beta</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;alpha-or-beta-cmd&#39;</span><span class="p">)</span>
    <span class="n">gamma</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;gamma-cmd&#39;</span><span class="p">)</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">get_subcommand</span><span class="p">(</span><span class="n">Root</span><span class="p">())</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;cmd_alpha&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta&#39;</span><span class="p">,</span> <span class="s1">&#39;--opt-beta=hey&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">get_subcommand</span><span class="p">(</span><span class="n">Root</span><span class="p">())</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;opt_beta&#39;</span><span class="p">:</span> <span class="s1">&#39;hey&#39;</span><span class="p">}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma-cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;--opt-gamma=hi&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">get_subcommand</span><span class="p">(</span><span class="n">Root</span><span class="p">())</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;opt_gamma&#39;</span><span class="p">:</span> <span class="s1">&#39;hi&#39;</span><span class="p">}</span>
</code></pre></div>
<h3 id="creating-cli-applications">创建 CLI 应用程序<a class="headerlink" href="#creating-cli-applications" title="Permanent link">&para;</a></h3>
<p><code>CliApp</code> 类提供了两个实用方法，<code>CliApp.run</code> 和 <code>CliApp.run_subcommand</code>，可用于将 Pydantic <code>BaseSettings</code>、<code>BaseModel</code> 或 <code>pydantic.dataclasses.dataclass</code> 作为 CLI 应用程序运行。这些方法主要为运行与模型关联的 <code>cli_cmd</code> 方法提供结构。</p>
<p><code>CliApp.run</code> 可用于直接提供要解析的 <code>cli_args</code>，并在实例化后运行模型的 <code>cli_cmd</code> 方法（如果已定义）：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliApp</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">this_foo</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Print the parsed data</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
        <span class="c1">#&gt; {&#39;this_foo&#39;: &#39;is such a foo&#39;}</span>

        <span class="c1"># Update the parsed data showing cli_cmd ran</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_foo</span> <span class="o">=</span> <span class="s1">&#39;ran the foo cli cmd&#39;</span>


<span class="n">s</span> <span class="o">=</span> <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Settings</span><span class="p">,</span> <span class="n">cli_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--this_foo&#39;</span><span class="p">,</span> <span class="s1">&#39;is such a foo&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;this_foo&#39;: &#39;ran the foo cli cmd&#39;}</span>
</code></pre></div>
<p>类似地，<code>CliApp.run_subcommand</code> 可以以递归方式用于运行子命令的 <code>cli_cmd</code> 方法：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CliApp</span><span class="p">,</span> <span class="n">CliPositionalArg</span><span class="p">,</span> <span class="n">CliSubCommand</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Init</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;git init &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="c1">#&gt; git init &quot;dir&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;ran the git init cli cmd&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Clone</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">repository</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;git clone from &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="si">}</span><span class="s1">&quot; into &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;ran the clone cli cmd&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Git</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">clone</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Clone</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Init</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">CliApp</span><span class="o">.</span><span class="n">run_subcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="n">cmd</span> <span class="o">=</span> <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Git</span><span class="p">,</span> <span class="n">cli_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">cmd</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;clone&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;ran the git init cli cmd&#39;</span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>与 <code>CliApp.run</code> 不同，<code>CliApp.run_subcommand</code> 要求子命令模型具有已定义的 <code>cli_cmd</code> 方法。</p>
</div>
<p>对于 <code>BaseModel</code> 和 <code>pydantic.dataclasses.dataclass</code> 类型，<code>CliApp.run</code> 将在内部使用以下
<code>BaseSettings</code> 配置默认值：</p>
<ul>
<li><code>nested_model_default_partial_update=True</code></li>
<li><code>case_sensitive=True</code></li>
<li><code>cli_hide_none_type=True</code></li>
<li><code>cli_avoid_json=True</code></li>
<li><code>cli_enforce_required=True</code></li>
<li><code>cli_implicit_flags=True</code></li>
<li><code>cli_kebab_case=True</code></li>
</ul>
<h3 id="cli">异步 CLI 命令<a class="headerlink" href="#cli" title="Permanent link">&para;</a></h3>
<p>Pydantic settings 支持通过 <code>CliApp.run</code> 和 <code>CliApp.run_subcommand</code> 运行异步 CLI 命令。通过此功能，你可以在 Pydantic 模型（包括子命令）中定义 async def 方法，并让它们像同步对应项一样执行。具体来说：</p>
<ol>
<li>支持异步方法：你现在可以将 cli_cmd 或类似的 CLI 入口点方法标记为 async def，并让 CliApp 执行它们。</li>
<li>子命令也可以是异步的：如果你有嵌套的 CLI 子命令，最终（最低级别）的子命令方法同样可以是异步的。</li>
<li>将异步方法限制在最终子命令：不建议将父命令定义为异步，因为这可能导致创建额外的线程和事件循环。为了获得最佳性能并避免不必要的资源使用，只实现最深层的（子）子命令为 async def。</li>
</ol>
<p>下面是一个演示异步顶级命令的简单示例：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliApp</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AsyncSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from an async CLI method!&#39;</span><span class="p">)</span>
        <span class="c1">#&gt; Hello from an async CLI method!</span>


<span class="c1"># If an event loop is already running, a new thread will be used;</span>
<span class="c1"># otherwise, asyncio.run() is used to execute this async method.</span>
<span class="k">assert</span> <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">AsyncSettings</span><span class="p">,</span> <span class="n">cli_args</span><span class="o">=</span><span class="p">[])</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{}</span>
</code></pre></div>
<h4 id="_13">异步子命令<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>如上所述，你也可以将子命令定义为异步。但是，仅在叶子（最低级别）子命令中这样做，以避免在父命令中不必要地生成新线程和事件循环：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">CliApp</span><span class="p">,</span>
    <span class="n">CliPositionalArg</span><span class="p">,</span>
    <span class="n">CliSubCommand</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Clone</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">repository</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">CliPositionalArg</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Perform async tasks here, e.g. network or I/O operations</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cloning async from &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="si">}</span><span class="s1">&quot; into &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="c1">#&gt; Cloning async from &quot;repo&quot; into &quot;dir&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Git</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">clone</span><span class="p">:</span> <span class="n">CliSubCommand</span><span class="p">[</span><span class="n">Clone</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cli_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Run the final subcommand (clone/init). It is recommended to define async methods only at the deepest level.</span>
        <span class="n">CliApp</span><span class="o">.</span><span class="n">run_subcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Git</span><span class="p">,</span> <span class="n">cli_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;clone&#39;</span><span class="p">,</span> <span class="s1">&#39;repo&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;repository&#39;</span><span class="p">:</span> <span class="s1">&#39;repo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>当执行具有异步 cli_cmd 的子命令时，Pydantic settings 会自动检测当前线程是否已有活动的事件循环。如果有，异步命令将在新线程中运行以避免冲突。否则，它将在当前线程中使用 asyncio.run()。这种处理确保你的异步子命令"正常工作"，无需额外的手动设置。</p>
<h3 id="cli_1">序列化 CLI 参数<a class="headerlink" href="#cli_1" title="Permanent link">&para;</a></h3>
<p>可以使用 <code>CliApp.serialize</code> 方法将实例化的 Pydantic 模型序列化为其 CLI 参数。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CliApp</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Nested</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">that</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">this</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">nested</span><span class="p">:</span> <span class="n">Nested</span>


<span class="nb">print</span><span class="p">(</span><span class="n">CliApp</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">Settings</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">Nested</span><span class="p">(</span><span class="n">that</span><span class="o">=</span><span class="mi">123</span><span class="p">))))</span>
<span class="c1">#&gt; [&#39;--this&#39;, &#39;hello&#39;, &#39;--nested.that&#39;, &#39;123&#39;]</span>
</code></pre></div>
<h3 id="_14">互斥组<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>可以通过继承 <code>CliMutuallyExclusiveGroup</code> 类来创建 CLI 互斥组。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>CliMutuallyExclusiveGroup</code> 不能在联合中使用，也不能包含嵌套模型。</p>
</div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CliApp</span><span class="p">,</span> <span class="n">CliMutuallyExclusiveGroup</span><span class="p">,</span> <span class="n">SettingsError</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="p">(</span><span class="n">CliMutuallyExclusiveGroup</span><span class="p">):</span>
    <span class="n">radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">diameter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">perimeter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">circle</span><span class="p">:</span> <span class="n">Circle</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">Settings</span><span class="p">,</span>
        <span class="n">cli_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--circle.radius=1&#39;</span><span class="p">,</span> <span class="s1">&#39;--circle.diameter=2&#39;</span><span class="p">],</span>
        <span class="n">cli_exit_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">SettingsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    error parsing CLI: argument --circle.diameter: not allowed with argument --circle.radius</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="cli_2">自定义 CLI 体验<a class="headerlink" href="#cli_2" title="Permanent link">&para;</a></h3>
<p>以下标志可用于根据你的需求自定义 CLI 体验。</p>
<h4 id="_15">更改显示的程序名称<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>通过设置 <code>cli_prog_name</code> 来更改帮助文本使用中显示的默认程序名称。默认情况下，它将从 <code>sys.argv[0]</code> 派生当前正在执行的程序的名称，就像 argparse 一样。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_prog_name</span><span class="o">=</span><span class="s1">&#39;appdantic&#39;</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: appdantic [-h]</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help  显示此帮助信息并退出</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="cli_3">CLI 布尔标志<a class="headerlink" href="#cli_3" title="Permanent link">&para;</a></h4>
<p>使用 <code>cli_implicit_flags</code> 设置来更改布尔字段默认应该是显式还是隐式。默认情况下，布尔字段是"显式"的，意味着必须在 CLI 上显式提供布尔值，例如 <code>--flag=True</code>。相反，"隐式"的布尔字段从标志本身派生值，例如 <code>--flag,--no-flag</code>，这消除了传递显式值的需要。</p>
<p>此外，提供的 <code>CliImplicitFlag</code> 和 <code>CliExplicitFlag</code> 注解可以在需要时用于更细粒度的控制。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliExplicitFlag</span><span class="p">,</span> <span class="n">CliImplicitFlag</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExplicitSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean fields are explicit by default.&quot;&quot;&quot;</span>

    <span class="n">explicit_req</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --explicit_req bool   (required)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">explicit_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --explicit_opt bool   (default: False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Booleans are explicit by default, so must override implicit flags with annotation</span>
    <span class="n">implicit_req</span><span class="p">:</span> <span class="n">CliImplicitFlag</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --implicit_req, --no-implicit_req (required)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implicit_opt</span><span class="p">:</span> <span class="n">CliImplicitFlag</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --implicit_opt, --no-implicit_opt (default: False)</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ImplicitSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_implicit_flags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;With cli_implicit_flags=True, boolean fields are implicit by default.&quot;&quot;&quot;</span>

    <span class="c1"># Booleans are implicit by default, so must override explicit flags with annotation</span>
    <span class="n">explicit_req</span><span class="p">:</span> <span class="n">CliExplicitFlag</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --explicit_req bool   (required)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">explicit_opt</span><span class="p">:</span> <span class="n">CliExplicitFlag</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --explicit_opt bool   (default: False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implicit_req</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --implicit_req, --no-implicit_req (required)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implicit_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --implicit_opt, --no-implicit_opt (default: False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="_16">忽略和检索未知参数<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>使用 <code>cli_ignore_unknown_args</code> 来更改是否忽略未知的 CLI 参数并仅解析已知的参数。默认情况下，CLI 不会忽略任何参数。然后可以使用 <code>CliUnknownArgs</code> 注解检索被忽略的参数。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliUnknownArgs</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_ignore_unknown_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">good_arg</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ignored_args</span><span class="p">:</span> <span class="n">CliUnknownArgs</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--bad-arg=bad&#39;</span><span class="p">,</span> <span class="s1">&#39;ANOTHER_BAD_ARG&#39;</span><span class="p">,</span> <span class="s1">&#39;--good_arg=hello world&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;good_arg&#39;: &#39;hello world&#39;, &#39;ignored_args&#39;: [&#39;--bad-arg=bad&#39;, &#39;ANOTHER_BAD_ARG&#39;]}</span>
</code></pre></div>
<h4 id="cli-kebab-case">CLI 参数的 Kebab Case<a class="headerlink" href="#cli-kebab-case" title="Permanent link">&para;</a></h4>
<p>通过启用 <code>cli_kebab_case</code> 来更改 CLI 参数是否应使用 kebab case。默认情况下，<code>cli_kebab_case=True</code> 将忽略枚举字段，相当于 <code>cli_kebab_case='no_enums'</code>。要将 kebab case 应用于所有内容，包括枚举，请使用 <code>cli_kebab_case='all'</code>。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_kebab_case</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">my_option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;will show as kebab case on CLI&#39;</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: example.py [-h] [--my-option str]</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help       显示此帮助信息并退出</span>
<span class="sd">  --my-option str  will show as kebab case on CLI (required)</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="cli_4">更改 CLI 是否应在出错时退出<a class="headerlink" href="#cli_4" title="Permanent link">&para;</a></h4>
<p>使用 <code>cli_exit_on_error</code> 来更改 CLI 内部解析器是在出错时退出还是引发 <code>SettingsError</code> 异常。默认情况下，CLI 内部解析器会在出错时退出。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsError</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_exit_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="o">...</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--bad-arg&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="n">SettingsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; error parsing CLI: unrecognized arguments: --bad-arg</span>
</code></pre></div>
<h4 id="cli_5">在 CLI 中强制执行必需参数<a class="headerlink" href="#cli_5" title="Permanent link">&para;</a></h4>
<p>Pydantic settings 设计用于在实例化模型时从各种来源拉取值。这意味着必需的字段并不严格要求来自任何单个来源（例如 CLI）。相反，重要的是其中一个来源提供所需的值。</p>
<p>但是，如果你的用例<a href="#command-line-support">更符合 #2</a>，即使用 Pydantic 模型定义 CLI，你可能希望必需字段在 CLI 中严格必需。我们可以通过使用 <code>cli_enforce_required</code> 来启用此行为。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>必需的 <code>CliPositionalArg</code> 字段在 CLI 中始终是严格必需的（强制执行的）。</p>
</div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsError</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cli_enforce_required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cli_exit_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">my_required_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;a top level required field&#39;</span><span class="p">)</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MY_REQUIRED_FIELD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hello from environment&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="n">SettingsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; error parsing CLI: the following arguments are required: --my_required_field</span>
</code></pre></div>
<h4 id="none">更改 None 类型解析字符串<a class="headerlink" href="#none" title="Permanent link">&para;</a></h4>
<p>通过设置 <code>cli_parse_none_str</code> 来更改将被解析为 <code>None</code> 的 CLI 字符串值（例如 "null"、"void"、"None" 等）。默认情况下，如果设置了 <code>env_parse_none_str</code> 值，它将使用该值。否则，如果 <code>cli_avoid_json</code> 为 <code>False</code>，则默认为 "null"，如果 <code>cli_avoid_json</code> 为 <code>True</code>，则默认为 "None"。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_parse_none_str</span><span class="o">=</span><span class="s1">&#39;void&#39;</span><span class="p">):</span>
    <span class="n">v1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;the top level v0 option&#39;</span><span class="p">)</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--v1&#39;</span><span class="p">,</span> <span class="s1">&#39;void&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;v1&#39;: None}</span>
</code></pre></div>
<h4 id="none_1">隐藏 None 类型值<a class="headerlink" href="#none_1" title="Permanent link">&para;</a></h4>
<p>通过启用 <code>cli_hide_none_type</code> 从 CLI 帮助文本中隐藏 <code>None</code> 值。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_hide_none_type</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">v0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;the top level v0 option&#39;</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: example.py [-h] [--v0 str]</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help  show this help message and exit</span>
<span class="sd">  --v0 str    the top level v0 option (required)</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="json-cli">避免添加 JSON CLI 选项<a class="headerlink" href="#json-cli" title="Permanent link">&para;</a></h4>
<p>通过启用 <code>cli_avoid_json</code> 来避免在 CLI 中添加导致 JSON 字符串的复杂字段。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">v1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;the sub model v1 option&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_avoid_json</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">sub_model</span><span class="p">:</span> <span class="n">SubModel</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The help summary for SubModel related options&#39;</span>
    <span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: example.py [-h] [--sub_model.v1 int]</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help          show this help message and exit</span>

<span class="sd">sub_model options:</span>
<span class="sd">  The help summary for SubModel related options</span>

<span class="sd">  --sub_model.v1 int  the sub model v1 option (required)</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="_17">使用类文档字符串作为组帮助文本<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>默认情况下，在填充嵌套模型的组帮助文本时，它将从字段描述中提取。或者，我们也可以配置 CLI 设置以从类文档字符串中提取。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果字段是嵌套模型的联合，组帮助文本将始终从字段描述中提取；即使 <code>cli_use_class_docs_for_groups</code> 设置为 <code>True</code>。</p>
</div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The help text from the class docstring.&quot;&quot;&quot;</span>

    <span class="n">v1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;the sub model v1 option&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_use_class_docs_for_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;My application help text.&quot;&quot;&quot;</span>

    <span class="n">sub_model</span><span class="p">:</span> <span class="n">SubModel</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;The help text from the field description&#39;</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: example.py [-h] [--sub_model JSON] [--sub_model.v1 int]</span>

<span class="sd">我的应用程序帮助文本。</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help          显示此帮助信息并退出</span>

<span class="sd">sub_model options:</span>
<span class="sd">  The help text from the class docstring.</span>

<span class="sd">  --sub_model JSON    set sub_model from JSON string</span>
<span class="sd">  --sub_model.v1 int  the sub model v1 option (required)</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="cli_6">更改 CLI 标志前缀字符<a class="headerlink" href="#cli_6" title="Permanent link">&para;</a></h4>
<p>通过设置 <code>cli_flag_prefix_char</code> 来更改 CLI 可选参数中使用的 CLI 标志前缀字符。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">AliasChoices</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cli_flag_prefix_char</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">):</span>
    <span class="n">my_arg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">validation_alias</span><span class="o">=</span><span class="n">AliasChoices</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;my-arg&#39;</span><span class="p">))</span>


<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;++my-arg&#39;</span><span class="p">,</span> <span class="s1">&#39;hi&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_arg&#39;: &#39;hi&#39;}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;+m&#39;</span><span class="p">,</span> <span class="s1">&#39;hi&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;my_arg&#39;: &#39;hi&#39;}</span>
</code></pre></div>
<h4 id="cli_7">从 CLI 帮助文本中抑制字段<a class="headerlink" href="#cli_7" title="Permanent link">&para;</a></h4>
<p>要从 CLI 帮助文本中抑制字段，可以使用 <code>CliSuppress</code> 注解用于字段类型，或者使用 <code>CLI_SUPPRESS</code> 字符串常量用于字段描述。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CLI_SUPPRESS</span><span class="p">,</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliSuppress</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">,</span> <span class="n">cli_parse_args</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;从 CLI 帮助文本中抑制字段。&quot;&quot;&quot;</span>

    <span class="n">field_a</span><span class="p">:</span> <span class="n">CliSuppress</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">field_b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">CLI_SUPPRESS</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">Settings</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1">#&gt; 0</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">usage: example.py [-h]</span>

<span class="sd">从 CLI 帮助文本中抑制字段。</span>

<span class="sd">options:</span>
<span class="sd">  -h, --help          显示此帮助信息并退出</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h4 id="cli_8">CLI 参数快捷方式<a class="headerlink" href="#cli_8" title="Permanent link">&para;</a></h4>
<p>使用 <code>SettingsConfigDict</code> 中的 <code>cli_shortcuts</code> 选项为字段添加替代的 CLI 参数名称（快捷方式）。这允许你为 CLI 参数定义额外的名称，这对于为深度嵌套或冗长的字段名称提供更用户友好或更短的别名特别有用。</p>
<p><code>cli_shortcuts</code> 选项接受一个字典，将目标字段名称（对嵌套字段使用点表示法）映射到一个或多个快捷方式名称。如果多个字段共享相同的快捷方式，第一个匹配的字段将优先。</p>
<p><strong>Flat Example:</strong></p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="n">list_option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;fizz&#39;</span><span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">cli_shortcuts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;option&#39;</span><span class="p">:</span> <span class="s1">&#39;option2&#39;</span><span class="p">,</span> <span class="s1">&#39;list_option&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;list_option2&#39;</span><span class="p">]}</span>
    <span class="p">)</span>


<span class="c1"># Now you can use the shortcuts on the CLI:</span>
<span class="c1"># --option2 sets &#39;option&#39;, --list_option2 sets &#39;list_option&#39;</span>
</code></pre></div>
<p><strong>Nested Example:</strong></p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TwiceNested</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Nested</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">twice_nested_option</span><span class="p">:</span> <span class="n">TwiceNested</span> <span class="o">=</span> <span class="n">TwiceNested</span><span class="p">()</span>
    <span class="n">option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">nested</span><span class="p">:</span> <span class="n">Nested</span> <span class="o">=</span> <span class="n">Nested</span><span class="p">()</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">cli_shortcuts</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;nested.option&#39;</span><span class="p">:</span> <span class="s1">&#39;option2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nested.twice_nested_option.option&#39;</span><span class="p">:</span> <span class="s1">&#39;twice_nested_option&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>


<span class="c1"># Now you can use --option2 to set nested.option and --twice_nested_option to set nested.twice_nested_option.option</span>
</code></pre></div>
<p>如果快捷方式发生冲突（映射到多个字段），它将应用于模型中第一个匹配的字段。</p>
<h3 id="_18">与现有解析器集成<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>可以通过用用户定义的指定 <code>root_parser</code> 对象的 CLI 设置源覆盖默认的 CLI 设置源来与现有解析器集成。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">argparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArgumentParser</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">CliApp</span><span class="p">,</span> <span class="n">CliSettingsSource</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--food&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pear&#39;</span><span class="p">,</span> <span class="s1">&#39;kiwi&#39;</span><span class="p">,</span> <span class="s1">&#39;lime&#39;</span><span class="p">])</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>


<span class="c1"># Set existing `parser` as the `root_parser` object for the user defined settings source</span>
<span class="n">cli_settings</span> <span class="o">=</span> <span class="n">CliSettingsSource</span><span class="p">(</span><span class="n">Settings</span><span class="p">,</span> <span class="n">root_parser</span><span class="o">=</span><span class="n">parser</span><span class="p">)</span>

<span class="c1"># Parse and load CLI settings from the command line into the settings source.</span>
<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;example.py&#39;</span><span class="p">,</span> <span class="s1">&#39;--food&#39;</span><span class="p">,</span> <span class="s1">&#39;kiwi&#39;</span><span class="p">,</span> <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;waldo&#39;</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Settings</span><span class="p">,</span> <span class="n">cli_settings_source</span><span class="o">=</span><span class="n">cli_settings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;name&#39;: &#39;waldo&#39;}</span>

<span class="c1"># Load CLI settings from pre-parsed arguments. i.e., the parsing occurs elsewhere and we</span>
<span class="c1"># just need to load the pre-parsed args into the settings source.</span>
<span class="n">parsed_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;--food&#39;</span><span class="p">,</span> <span class="s1">&#39;kiwi&#39;</span><span class="p">,</span> <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;ralph&#39;</span><span class="p">])</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">CliApp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Settings</span><span class="p">,</span> <span class="n">cli_args</span><span class="o">=</span><span class="n">parsed_args</span><span class="p">,</span> <span class="n">cli_settings_source</span><span class="o">=</span><span class="n">cli_settings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;name&#39;: &#39;ralph&#39;}</span>
</code></pre></div>
<p><code>CliSettingsSource</code> 通过使用解析器方法将 <code>settings_cls</code> 字段添加为命令行参数来与 <code>root_parser</code> 对象连接。<code>CliSettingsSource</code> 内部解析器表示基于 <code>argparse</code> 库，因此需要支持与其 <code>argparse</code> 对应项相同属性的解析器方法。可以自定义的可用解析器方法及其 argparse 对应项（默认值）如下：</p>
<ul>
<li><code>parse_args_method</code> - (<code>argparse.ArgumentParser.parse_args</code>)</li>
<li><code>add_argument_method</code> - (<code>argparse.ArgumentParser.add_argument</code>)</li>
<li><code>add_argument_group_method</code> - (<code>argparse.ArgumentParser.add_argument_group</code>)</li>
<li><code>add_parser_method</code> - (<code>argparse._SubParsersAction.add_parser</code>)</li>
<li><code>add_subparsers_method</code> - (<code>argparse.ArgumentParser.add_subparsers</code>)</li>
<li><code>formatter_class</code> - (<code>argparse.RawDescriptionHelpFormatter</code>)</li>
</ul>
<p>对于非 argparse 解析器，如果不支持，解析器方法可以设置为 <code>None</code>。只有当解析器方法必要但设置为 <code>None</code> 时，CLI 设置才会在连接到根解析器时引发错误。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>formatter_class</code> 仅应用于子命令。<code>CliSettingsSource</code> 从不接触或修改任何外部解析器设置以避免破坏性更改。由于子命令驻留在它们自己的内部解析器树上，我们可以安全地应用 <code>formatter_class</code> 设置而不会破坏外部解析器逻辑。</p>
</div>
<h2 id="secrets">Secrets<a class="headerlink" href="#secrets" title="Permanent link">&para;</a></h2>
<p>将密钥值放在文件中是为应用程序提供敏感配置的常见模式。</p>
<p>密钥文件遵循与 dotenv 文件相同的原则，只是它只包含单个值，并且文件名用作键。密钥文件将如下所示：</p>
<div class="language-text highlight"><span class="filename">/var/run/database_password</span><pre><span></span><code>super_secret_database_password
</code></pre></div>
<p>一旦您有了密钥文件，<em>pydantic</em> 支持通过两种方式加载它：</p>
<ol>
<li>在 <code>BaseSettings</code> 类的 <code>model_config</code> 上设置 <code>secrets_dir</code> 到存储密钥文件的目录。
   <div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="hll"><span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
</span><span class="hll">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">secrets_dir</span><span class="o">=</span><span class="s1">&#39;/var/run&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">database_password</span><span class="p">:</span> <span class="nb">str</span>
</span></code></pre></div></li>
<li>使用 <code>_secrets_dir</code> 关键字参数实例化 <code>BaseSettings</code> 派生类：
   <div class="language-text highlight"><pre><span></span><code>settings = Settings(_secrets_dir=&#39;/var/run&#39;)
</code></pre></div></li>
</ol>
<p>无论哪种情况，传递的参数值可以是任何有效目录，绝对路径或相对于当前工作目录。<strong>请注意，不存在的目录只会生成警告</strong>。
从那里，<em>pydantic</em> 将通过加载变量并验证它们来处理所有事情。</p>
<p>即使使用密钥目录，<em>pydantic</em> 仍将从 dotenv 文件或环境中读取环境变量，<strong>dotenv 文件和环境变量始终优先于从密钥目录加载的值</strong>。</p>
<p>在实例化时通过 <code>_secrets_dir</code> 关键字参数传递文件路径（方法 2）将覆盖在 <code>model_config</code> 类上设置的任何值。</p>
<p>如果需要从多个密钥目录加载设置，可以将多个路径作为元组或列表传递。就像 <code>env_file</code> 一样，后续路径的值会覆盖先前的值。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="c1"># &#39;/run/secrets&#39; 中的文件优先于 &#39;/var/run&#39;</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">secrets_dir</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;/var/run&#39;</span><span class="p">,</span> <span class="s1">&#39;/run/secrets&#39;</span><span class="p">))</span>

    <span class="n">database_password</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
<p>如果任何 <code>secrets_dir</code> 缺失，它将被忽略，并显示警告。如果任何 <code>secrets_dir</code> 是文件，将引发错误。</p>
<h3 id="docker-secrets">用例：Docker Secrets<a class="headerlink" href="#docker-secrets" title="Permanent link">&para;</a></h3>
<p>Docker Secrets 可用于为在 Docker 容器中运行的应用程序提供敏感配置。
要在 <em>pydantic</em> 应用程序中使用这些密钥，过程很简单。有关在 Docker 中创建、管理和使用密钥的更多信息，请参阅官方
<a href="https://docs.docker.com/engine/reference/commandline/secret/">Docker 文档</a>。</p>
<p>首先，使用指定密钥目录的 <code>SettingsConfigDict</code> 定义您的 <code>Settings</code> 类。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>


<span class="hll"><span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
</span><span class="hll">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">secrets_dir</span><span class="o">=</span><span class="s1">&#39;/run/secrets&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">my_secret_data</span><span class="p">:</span> <span class="nb">str</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>默认情况下 <a href="https://docs.docker.com/engine/swarm/secrets/#how-docker-manages-secrets">Docker 使用 <code>/run/secrets</code></a>
作为目标挂载点。如果您想使用不同的位置，请相应地更改 <code>Config.secrets_dir</code>。</p>
</div>
<p>然后，通过 Docker CLI 创建您的密钥
<div class="language-bash highlight"><pre><span></span><code><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;This is a secret&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>secret<span class="w"> </span>create<span class="w"> </span>my_secret_data<span class="w"> </span>-
</code></pre></div></p>
<p>最后，在 Docker 容器内运行您的应用程序并提供新创建的密钥
<div class="language-bash highlight"><pre><span></span><code>docker<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>pydantic-with-secrets<span class="w"> </span>--secret<span class="w"> </span>my_secret_data<span class="w"> </span>pydantic-app:latest
</code></pre></div></p>
<h2 id="_19">嵌套密钥<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h2>
<p>默认的密钥实现 <code>SecretsSettingsSource</code> 的行为并不总是理想或足够的。
例如，默认实现不支持嵌套子模型中的密钥字段。</p>
<p><code>NestedSecretsSettingsSource</code> 可以用作 <code>SecretsSettingsSource</code> 的直接替代品来调整默认行为。
所有差异总结在下表中。</p>
<table>
<thead>
<tr>
<th><code>SecretsSettingsSource</code></th>
<th><code>NestedSecretsSettingsSourcee</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>密钥字段必须属于顶级模型。</td>
<td>密钥可以是嵌套模型的字段。</td>
</tr>
<tr>
<td>密钥文件只能放在 <code>secrets_dir</code> 中。</td>
<td>密钥文件可以放在嵌套模型的子目录中。</td>
</tr>
<tr>
<td>密钥文件发现基于与 <code>EnvSettingsSource</code> 相同的配置选项：<code>case_sensitive</code>、<code>env_nested_delimiter</code>、<code>env_prefix</code>。</td>
<td>默认选项被尊重，但可以用 <code>secrets_case_sensitive</code>、<code>secrets_nested_delimiter</code>、<code>secrets_prefix</code> 覆盖。</td>
</tr>
<tr>
<td>当 <code>secrets_dir</code> 在文件系统中缺失时，会生成警告。</td>
<td>使用 <code>secrets_dir_missing</code> 选项选择是发出警告、引发错误还是静默忽略。</td>
</tr>
</tbody>
</table>
<h3 id="_20">用例：普通目录布局<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code>📂 secrets
├── 📄 app_key
└── 📄 db_passwd
</code></pre></div>
<p>在下面的示例中，密钥嵌套分隔符 <code>'_'</code> 与环境嵌套分隔符 <code>'__'</code> 不同。
<code>Settings.db.user</code> 的值可以通过环境变量 <code>MY_DB__USER</code> 传递。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">NestedSecretsSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DbSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">passwd</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">AppSettings</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DbSettings</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;MY_&#39;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span>
        <span class="n">secrets_dir</span><span class="o">=</span><span class="s1">&#39;secrets&#39;</span><span class="p">,</span>
        <span class="n">secrets_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">,</span>
        <span class="n">init_settings</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">NestedSecretsSettingsSource</span><span class="p">(</span><span class="n">file_secret_settings</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="_21">用例：嵌套目录布局<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p><div class="language-text highlight"><pre><span></span><code>📂 secrets
├── 📂 app
│   └── 📄 key
└── 📂 db
    └── 📄 passwd
</code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">NestedSecretsSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DbSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">passwd</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">AppSettings</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DbSettings</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;MY_&#39;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span>
        <span class="n">secrets_dir</span><span class="o">=</span><span class="s1">&#39;secrets&#39;</span><span class="p">,</span>
        <span class="n">secrets_nested_subdir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">,</span>
        <span class="n">init_settings</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">NestedSecretsSettingsSource</span><span class="p">(</span><span class="n">file_secret_settings</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></p>
<h3 id="_22">用例：多个嵌套目录<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p><div class="language-text highlight"><pre><span></span><code>📂 secrets
├── 📂 default
│   ├── 📂 app
│   │   └── 📄 key
│   └── 📂 db
│       └── 📄 passwd
└── 📂 override
    ├── 📂 app
    │   └── 📄 key
    └── 📂 db
        └── 📄 passwd
</code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">NestedSecretsSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DbSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">passwd</span><span class="p">:</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">AppSettings</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DbSettings</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;MY_&#39;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span>
        <span class="n">secrets_dir</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;secrets/default&#39;</span><span class="p">,</span> <span class="s1">&#39;secrets/override&#39;</span><span class="p">],</span>
        <span class="n">secrets_nested_subdir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">,</span>
        <span class="n">init_settings</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">NestedSecretsSettingsSource</span><span class="p">(</span><span class="n">file_secret_settings</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></p>
<h3 id="_23">配置选项<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<h4 id="secrets_dir">secrets_dir<a class="headerlink" href="#secrets_dir" title="Permanent link">&para;</a></h4>
<p>密钥目录的路径，与 <code>SecretsSettingsSource.secrets_dir</code> 相同。如果是 <code>list</code>，最后一个匹配项获胜。
如果同时在源构造函数和模型配置中传递 <code>secrets_dir</code>，值不会合并（构造函数获胜）。</p>
<h4 id="secrets_dir_missing">secrets_dir_missing<a class="headerlink" href="#secrets_dir_missing" title="Permanent link">&para;</a></h4>
<p>如果 <code>secrets_dir</code> 不存在，原始的 <code>SecretsSettingsSource</code> 会发出警告。
然而，这可能是不希望的，例如，如果我们在开发环境中没有挂载 Docker Secrets。
使用 <code>secrets_dir_missing</code> 来选择：</p>
<ul>
<li><code>'ok'</code> — 如果 <code>secrets_dir</code> 不存在，什么也不做</li>
<li><code>'warn'</code>（默认）— 打印警告，与 <code>SecretsSettingsSource</code> 相同</li>
<li><code>'error'</code> — 引发 <code>SettingsError</code></li>
</ul>
<p>如果传递了多个 <code>secrets_dir</code>，相同的 <code>secrets_dir_missing</code> 操作适用于每个目录。</p>
<h4 id="secrets_dir_max_size">secrets_dir_max_size<a class="headerlink" href="#secrets_dir_max_size" title="Permanent link">&para;</a></h4>
<p>出于安全原因限制 <code>secrets_dir</code> 的大小，默认为 <code>SECRETS_DIR_MAX_SIZE</code> 等于 16 MiB。</p>
<p><code>NestedSecretsSettingsSource</code> 是围绕 <code>EnvSettingsSource</code> 的薄包装器，
它在初始化时加载所有潜在的密钥。如果我们在 <code>secrets_dir</code> 下挂载一个大文件，这可能导致 <code>MemoryError</code>。</p>
<p>如果传递了多个 <code>secrets_dir</code>，限制独立应用于每个目录。</p>
<h4 id="secrets_case_sensitive">secrets_case_sensitive<a class="headerlink" href="#secrets_case_sensitive" title="Permanent link">&para;</a></h4>
<p>与 <code>case_sensitive</code> 相同，但仅适用于密钥。如果未指定，默认为 <code>case_sensitive</code>。</p>
<h4 id="secrets_nested_delimiter">secrets_nested_delimiter<a class="headerlink" href="#secrets_nested_delimiter" title="Permanent link">&para;</a></h4>
<p>与 <code>env_nested_delimiter</code> 相同，但仅适用于密钥。如果未指定，默认为 <code>env_nested_delimiter</code>。
此选项用于实现_嵌套密钥目录_布局，并允许执行甚至像 <code>/run/secrets/model/delim/nested1/delim/nested2</code> 这样的复杂操作。</p>
<h4 id="secrets_nested_subdir">secrets_nested_subdir<a class="headerlink" href="#secrets_nested_subdir" title="Permanent link">&para;</a></h4>
<p>布尔标志，用于打开_嵌套密钥目录_模式，默认为 <code>False</code>。如果为 <code>True</code>，将 <code>secrets_nested_delimiter</code>
设置为 <code>os.sep</code>。如果已经指定了 <code>secrets_nested_delimiter</code>，则引发 <code>SettingsError</code>。</p>
<h4 id="secrets_prefix">secrets_prefix<a class="headerlink" href="#secrets_prefix" title="Permanent link">&para;</a></h4>
<p>密钥路径前缀，类似于 <code>env_prefix</code>，但仅适用于密钥。如果未指定，默认为 <code>env_prefix</code>。
在普通和嵌套目录模式下都有效，如 <code>'/run/secrets/prefix_model__nested'</code> 和 <code>'/run/secrets/prefix_model/nested'</code>。</p>
<h2 id="aws-secrets-manager">AWS Secrets Manager<a class="headerlink" href="#aws-secrets-manager" title="Permanent link">&para;</a></h2>
<p>您必须设置一个参数：</p>
<ul>
<li><code>secret_id</code>：AWS 密钥 ID</li>
</ul>
<p>您必须在密钥中的键值与字段名称中使用相同的命名约定。例如，如果密钥中的键名为 <code>SqlServerPassword</code>，字段名称必须相同。您也可以使用别名。</p>
<p>在 AWS Secrets Manager 中，嵌套模型支持在键名中使用 <code>--</code> 分隔符。例如，<code>SqlServer--Password</code>。</p>
<p>不支持数组（例如 <code>MySecret--0</code>、<code>MySecret--1</code>）。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AWSSecretsManagerSettingsSource</span><span class="p">,</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AWSSecretsManagerSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">sub</span><span class="p">:</span> <span class="n">SubModel</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="n">aws_secrets_manager_settings</span> <span class="o">=</span> <span class="n">AWSSecretsManagerSettingsSource</span><span class="p">(</span>
            <span class="n">settings_cls</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_SECRETS_MANAGER_SECRET_ID&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">file_secret_settings</span><span class="p">,</span>
            <span class="n">aws_secrets_manager_settings</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
<h2 id="azure-key-vault">Azure Key Vault<a class="headerlink" href="#azure-key-vault" title="Permanent link">&para;</a></h2>
<p>您必须设置两个参数：</p>
<ul>
<li><code>url</code>：例如，<code>https://my-resource.vault.azure.net/</code>。</li>
<li><code>credential</code>：如果您使用 <code>DefaultAzureCredential</code>，在本地可以执行 <code>az login</code> 来获取您的身份凭据。身份必须具有角色分配（推荐的是 <code>Key Vault Secrets User</code>），以便您可以访问密钥。</li>
</ul>
<p>您必须在字段名称与 Key Vault 密钥名称中使用相同的命名约定。例如，如果密钥名为 <code>SqlServerPassword</code>，字段名称必须相同。您也可以使用别名。</p>
<p>在 Key Vault 中，嵌套模型支持使用 <code>--</code> 分隔符。例如，<code>SqlServer--Password</code>。</p>
<p>不支持 Key Vault 数组（例如 <code>MySecret--0</code>、<code>MySecret--1</code>）。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AzureKeyVaultSettingsSource</span><span class="p">,</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SubModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AzureKeyVaultSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">sub</span><span class="p">:</span> <span class="n">SubModel</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="n">az_key_vault_settings</span> <span class="o">=</span> <span class="n">AzureKeyVaultSettingsSource</span><span class="p">(</span>
            <span class="n">settings_cls</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AZURE_KEY_VAULT_URL&#39;</span><span class="p">],</span>
            <span class="n">DefaultAzureCredential</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">file_secret_settings</span><span class="p">,</span>
            <span class="n">az_key_vault_settings</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="snake-case">Snake case 转换<a class="headerlink" href="#snake-case" title="Permanent link">&para;</a></h3>
<p>Azure Key Vault 源接受一个 <code>snake_case_convertion</code> 选项，默认禁用，用于通过将 Key Vault 密钥名称映射到 Python 的 snake_case 字段名称来转换它们，无需使用别名。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AzureKeyVaultSettingsSource</span><span class="p">,</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AzureKeyVaultSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">my_setting</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="n">az_key_vault_settings</span> <span class="o">=</span> <span class="n">AzureKeyVaultSettingsSource</span><span class="p">(</span>
            <span class="n">settings_cls</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AZURE_KEY_VAULT_URL&#39;</span><span class="p">],</span>
            <span class="n">DefaultAzureCredential</span><span class="p">(),</span>
            <span class="n">snake_case_conversion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">az_key_vault_settings</span><span class="p">,)</span>
</code></pre></div>
<p>此设置将加载 Azure Key Vault 密钥（例如，<code>MySetting</code>、<code>mySetting</code>、<code>my-secret</code> 或 <code>MY-SECRET</code>），将它们映射到 snake case 版本（本例中为 <code>my_setting</code>）。</p>
<h3 id="_24">破折号到下划线映射<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>Azure Key Vault 源接受一个 <code>dash_to_underscore</code> 选项，默认禁用，用于通过将 Key Vault kebab-case 密钥名称映射到 Python 的 snake_case 字段名称来支持它们。启用后，在验证期间，密钥名称中的破折号（<code>-</code>）将映射到字段名称中的下划线（<code>_</code>）。</p>
<p>此映射仅适用于<em>字段名称</em>，不适用于别名。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AzureKeyVaultSettingsSource</span><span class="p">,</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AzureKeyVaultSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">field_with_underscore</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">field_with_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s1">&#39;Alias-With-Dashes&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="n">az_key_vault_settings</span> <span class="o">=</span> <span class="n">AzureKeyVaultSettingsSource</span><span class="p">(</span>
            <span class="n">settings_cls</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AZURE_KEY_VAULT_URL&#39;</span><span class="p">],</span>
            <span class="n">DefaultAzureCredential</span><span class="p">(),</span>
            <span class="n">dash_to_underscore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">az_key_vault_settings</span><span class="p">,)</span>
</code></pre></div>
<p>此设置将加载名为 <code>field-with-underscore</code> 和 <code>Alias-With-Dashes</code> 的 Azure Key Vault 密钥，分别将它们映射到 <code>field_with_underscore</code> 和 <code>field_with_alias</code> 字段。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>或者，您可以配置 <a href="../alias/#using-alias-generators">alias_generator</a> 来映射 PascalCase 密钥。</p>
</div>
<h2 id="google-cloud-secret-manager">Google Cloud Secret Manager<a class="headerlink" href="#google-cloud-secret-manager" title="Permanent link">&para;</a></h2>
<p>Google Cloud Secret Manager 允许您在 Google Cloud Platform 中存储、管理和访问敏感信息作为密钥。此集成使您可以直接从 GCP Secret Manager 检索密钥以用于您的 Pydantic 设置。</p>
<h3 id="_25">安装<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>Google Cloud Secret Manager 集成需要额外的依赖项：</p>
<div class="language-bash highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;pydantic-settings[gcp-secret-manager]&quot;</span>
</code></pre></div>
<h3 id="_26">基本用法<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>要使用 Google Cloud Secret Manager，您需要：</p>
<ol>
<li>创建一个 <code>GoogleSecretManagerSettingsSource</code>。（有关身份验证选项，请参阅 <a href="#gcp-authentication">GCP Authentication</a>。）</li>
<li>将此源添加到您的设置自定义管道中</li>
</ol>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">GoogleSecretManagerSettingsSource</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Database</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Database</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="c1"># Create the GCP Secret Manager settings source</span>
        <span class="n">gcp_settings</span> <span class="o">=</span> <span class="n">GoogleSecretManagerSettingsSource</span><span class="p">(</span>
            <span class="n">settings_cls</span><span class="p">,</span>
            <span class="c1"># If not provided, will use google.auth.default()</span>
            <span class="c1"># to get credentials from the environemnt</span>
            <span class="c1"># credentials=your_credentials,</span>
            <span class="c1"># If not provided, will use google.auth.default()</span>
            <span class="c1"># to get project_id from the environemnt</span>
            <span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;your-gcp-project-id&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">dotenv_settings</span><span class="p">,</span>
            <span class="n">file_secret_settings</span><span class="p">,</span>
            <span class="n">gcp_settings</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="gcp-authentication">GCP Authentication<a class="headerlink" href="#gcp-authentication" title="Permanent link">&para;</a></h3>
<p><code>GoogleSecretManagerSettingsSource</code> 支持多种身份验证方法：</p>
<ol>
<li>
<p><strong>默认凭据</strong> - 如果您不提供凭据或项目 ID，它将使用 <a href="https://google-auth.readthedocs.io/en/master/reference/google.auth.html#google.auth.default"><code>google.auth.default()</code></a> 来获取它们。这适用于：</p>
</li>
<li>
<p>来自 <code>GOOGLE_APPLICATION_CREDENTIALS</code> 环境变量的服务账户凭据</p>
</li>
<li>来自 <code>gcloud auth application-default login</code> 的用户凭据</li>
<li>
<p>Compute Engine、GKE、Cloud Run 或 Cloud Functions 的默认服务账户</p>
</li>
<li>
<p><strong>显式凭据</strong> - 您也可以直接提供 <code>credentials</code>。例如 <code>sa_credentials = google.oauth2.service_account.Credentials.from_service_account_file('path/to/service-account.json')</code>，然后使用 <code>GoogleSecretManagerSettingsSource(credentials=sa_credentials)</code></p>
</li>
</ol>
<h3 id="_27">嵌套模型<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>对于嵌套模型，只要符合<a href="https://cloud.google.com/secret-manager/docs/creating-and-accessing-secrets#create-a-secret">命名规则</a>，Secret Manager 支持 <code>env_nested_delimiter</code> 设置。在上面的示例中，您需要在 Secret Manager 中创建名为 <code>database__password</code> 和 <code>database__user</code> 的密钥。</p>
<h3 id="_28">重要注意事项<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>大小写敏感性</strong>：默认情况下，密钥名称是区分大小写的。</li>
<li><strong>密钥命名</strong>：在 Google Secret Manager 中创建密钥时，名称应与您的字段名称匹配（包括任何前缀）。根据 <a href="https://cloud.google.com/secret-manager/docs/creating-and-accessing-secrets#create-a-secret">Secret Manager 文档</a>，密钥名称可以包含大写和小写字母、数字、连字符和下划线。名称的最大允许长度为 255 个字符。</li>
<li><strong>密钥版本</strong>：<code>GoogleSecretManagerSettingsSource</code> 使用密钥的"最新"版本。</li>
</ol>
<p>有关在 Google Cloud Secret Manager 中创建和管理密钥的更多详细信息，请参阅<a href="https://cloud.google.com/secret-manager/docs">官方 Google Cloud 文档</a>。</p>
<h2 id="_29">其他设置源<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h2>
<p>其他设置源可用于常见的配置文件：</p>
<ul>
<li><code>JsonConfigSettingsSource</code> 使用 <code>json_file</code> 和 <code>json_file_encoding</code> 参数</li>
<li><code>PyprojectTomlConfigSettingsSource</code> 使用 <em>(可选)</em> <code>pyproject_toml_depth</code> 和 <em>(可选)</em> <code>pyproject_toml_table_header</code> 参数</li>
<li><code>TomlConfigSettingsSource</code> 使用 <code>toml_file</code> 参数</li>
<li><code>YamlConfigSettingsSource</code> 使用 <code>yaml_file</code> 和 yaml_file_encoding 参数</li>
</ul>
<p>您还可以通过提供路径列表来提供多个文件：
<div class="language-py highlight"><pre><span></span><code><span class="n">toml_file</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;config.default.toml&#39;</span><span class="p">,</span> <span class="s1">&#39;config.custom.toml&#39;</span><span class="p">]</span>
</code></pre></div>
要使用它们，您可以使用<a href="#customise-settings-sources">此处</a>描述的相同机制</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
    <span class="n">TomlConfigSettingsSource</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Nested</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">nested_field</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">foobar</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">nested</span><span class="p">:</span> <span class="n">Nested</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">toml_file</span><span class="o">=</span><span class="s1">&#39;config.toml&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">TomlConfigSettingsSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">),)</span>
</code></pre></div>
<p>这将能够读取位于工作目录中的以下 "config.toml" 文件：</p>
<div class="language-toml highlight"><pre><span></span><code><span class="n">foobar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span>
<span class="k">[nested]</span>
<span class="n">nested_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;world!&quot;</span>
</code></pre></div>
<h3 id="pyprojecttoml">pyproject.toml<a class="headerlink" href="#pyprojecttoml" title="Permanent link">&para;</a></h3>
<p>"pyproject.toml" 是一个标准化的文件，用于在 Python 项目中提供配置值。
<a href="https://peps.python.org/pep-0518/#tool-table">PEP 518</a> 定义了一个 <code>[tool]</code> 表，可用于提供任意工具配置。
虽然鼓励使用 <code>[tool]</code> 表，但 <code>PyprojectTomlConfigSettingsSource</code> 可用于从 "pyproject.toml" 文件中的任何位置加载变量。</p>
<p>这通过提供 <code>SettingsConfigDict(pyproject_toml_table_header=tuple[str, ...])</code> 来控制，其中值是一个头部部分的元组。
默认情况下，<code>pyproject_toml_table_header=('tool', 'pydantic-settings')</code>，这将从 <code>[tool.pydantic-settings]</code> 表加载变量。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="n">PyprojectTomlConfigSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example loading values from the table used by default.&quot;&quot;&quot;</span>

    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">PyprojectTomlConfigSettingsSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">),)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeTableSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example loading values from a user defined table.&quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">pyproject_toml_table_header</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tool&#39;</span><span class="p">,</span> <span class="s1">&#39;some-table&#39;</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RootSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example loading values from the root of a pyproject.toml file.&quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">extra</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">pyproject_toml_table_header</span><span class="o">=</span><span class="p">())</span>
</code></pre></div>
<p>这将能够读取位于工作目录中的以下 "pyproject.toml" 文件，结果为 <code>Settings(field='default-table')</code>、<code>SomeTableSettings(field='some-table')</code> 和 <code>RootSettings(field='root')</code>：</p>
<div class="language-toml highlight"><pre><span></span><code><span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;root&quot;</span>

<span class="k">[tool.pydantic-settings]</span>
<span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default-table&quot;</span>

<span class="k">[tool.some-table]</span>
<span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;some-table&quot;</span>
</code></pre></div>
<p>默认情况下，<code>PyprojectTomlConfigSettingsSource</code> 只会在当前工作目录中查找 "pyproject.toml"。
但是，有两个选项可以改变这种行为。</p>
<ul>
<li>可以提供 <code>SettingsConfigDict(pyproject_toml_depth=&lt;int&gt;)</code> 来检查目录树中 <strong>向上</strong> <code>&lt;int&gt;</code> 个目录以查找 "pyproject.toml"，如果在当前工作目录中未找到。
  默认情况下，不检查父目录。</li>
<li>可以在实例化源时提供显式文件路径（例如 <code>PyprojectTomlConfigSettingsSource(settings_cls, Path('~/.config').resolve() / 'pyproject.toml')</code>）。
  如果以这种方式提供文件路径，它将被视为绝对路径（不检查其他位置）。</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="n">PyprojectTomlConfigSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DiscoverSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of discovering a pyproject.toml in parent directories in not in `Path.cwd()`.&quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">pyproject_toml_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">PyprojectTomlConfigSettingsSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">),)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExplicitFilePathSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of explicitly providing the path to the file to load.&quot;&quot;&quot;</span>

    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">PyprojectTomlConfigSettingsSource</span><span class="p">(</span>
                <span class="n">settings_cls</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;~/.config&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;pyproject.toml&#39;</span>
            <span class="p">),</span>
        <span class="p">)</span>
</code></pre></div>
<h2 id="field-value-priority">字段值优先级<a class="headerlink" href="#field-value-priority" title="Permanent link">&para;</a></h2>
<p>当以多种方式为同一个 <code>Settings</code> 字段指定值时，所选值按以下优先级确定（按优先级降序排列）：</p>
<ol>
<li>如果启用了 <code>cli_parse_args</code>，则在 CLI 传递的参数。</li>
<li>传递给 <code>Settings</code> 类初始化器的参数。</li>
<li>环境变量，例如上面描述的 <code>my_prefix_special_function</code>。</li>
<li>从 dotenv (<code>.env</code>) 文件加载的变量。</li>
<li>从 secrets 目录加载的变量。</li>
<li><code>Settings</code> 模型的默认字段值。</li>
</ol>
<h2 id="customise-settings-sources">自定义设置源<a class="headerlink" href="#customise-settings-sources" title="Permanent link">&para;</a></h2>
<p>如果默认的优先级顺序不符合你的需求，可以通过重写 <code>Settings</code> 的 <code>settings_customise_sources</code> 方法来更改它。</p>
<p><code>settings_customise_sources</code> 接受四个可调用对象作为参数，并返回任意数量的可调用对象作为元组。
这些可调用对象依次被调用来构建设置类字段的输入。</p>
<p>每个可调用对象应将设置类的实例作为其唯一参数并返回一个 <code>dict</code>。</p>
<h3 id="_30">更改优先级<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>返回的可调用对象的顺序决定了输入的优先级；第一项具有最高优先级。</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">PostgresDsn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">PydanticBaseSettingsSource</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">database_dsn</span><span class="p">:</span> <span class="n">PostgresDsn</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">env_settings</span><span class="p">,</span> <span class="n">init_settings</span><span class="p">,</span> <span class="n">file_secret_settings</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">(</span><span class="n">database_dsn</span><span class="o">=</span><span class="s1">&#39;postgres://postgres@localhost:5432/kwargs_db&#39;</span><span class="p">))</span>
<span class="c1">#&gt; database_dsn=PostgresDsn(&#39;postgres://postgres@localhost:5432/kwargs_db&#39;)</span>
</code></pre></div>
<p>通过交换 <code>env_settings</code> 和 <code>init_settings</code>，环境变量现在优先于 <code>__init__</code> 关键字参数。</p>
<h3 id="_31">添加源<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>如前所述，<em>pydantic</em> 附带多个内置设置源。但是，你可能偶尔需要添加自己的自定义源，<code>settings_customise_sources</code> 使这变得非常容易：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldInfo</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSettings</span><span class="p">,</span>
    <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="n">SettingsConfigDict</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">JsonConfigSettingsSource</span><span class="p">(</span><span class="n">PydanticBaseSettingsSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple settings source class that loads variables from a JSON file</span>
<span class="sd">    at the project&#39;s root.</span>

<span class="sd">    Here we happen to choose to use the `env_file_encoding` from Config</span>
<span class="sd">    when reading `config.json`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldInfo</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;env_file_encoding&#39;</span><span class="p">)</span>
        <span class="n">file_content_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;tests/example_test_config.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">field_value</span> <span class="o">=</span> <span class="n">file_content_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">field_value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_field_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldInfo</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value_is_complex</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_cls</span><span class="o">.</span><span class="n">model_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">field_value</span><span class="p">,</span> <span class="n">field_key</span><span class="p">,</span> <span class="n">value_is_complex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field_value</span><span class="p">(</span>
                <span class="n">field</span><span class="p">,</span> <span class="n">field_name</span>
            <span class="p">)</span>
            <span class="n">field_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_field_value</span><span class="p">(</span>
                <span class="n">field_name</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">field_value</span><span class="p">,</span> <span class="n">value_is_complex</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">field_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">field_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

        <span class="k">return</span> <span class="n">d</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="n">foobar</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">init_settings</span><span class="p">,</span>
            <span class="n">JsonConfigSettingsSource</span><span class="p">(</span><span class="n">settings_cls</span><span class="p">),</span>
            <span class="n">env_settings</span><span class="p">,</span>
            <span class="n">file_secret_settings</span><span class="p">,</span>
        <span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Settings</span><span class="p">())</span>
<span class="c1">#&gt; foobar=&#39;test&#39;</span>
</code></pre></div>
<h4 id="_32">访问先前源的结果<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h4>
<p>每个设置源都可以访问先前源的结果。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldInfo</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">PydanticBaseSettingsSource</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomSource</span><span class="p">(</span><span class="n">PydanticBaseSettingsSource</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldInfo</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span> <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># Retrieve the aggregated settings from previous sources</span>
        <span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span>
        <span class="n">current_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;some_setting&#39;</span><span class="p">)</span>

        <span class="c1"># Retrive settings from all sources individually</span>
        <span class="c1"># self.settings_sources_data[&quot;SettingsSourceName&quot;]: dict[str, Any]</span>
        <span class="n">settings_sources_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_sources_data</span>
        <span class="n">settings_sources_data</span><span class="p">[</span><span class="s1">&#39;SomeSettingsSource&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;some_setting&#39;</span><span class="p">)</span>

        <span class="c1"># Your code here...</span>
</code></pre></div>
<h3 id="_33">移除源<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>你可能也想禁用某个源：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">PydanticBaseSettingsSource</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">my_api_key</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_customise_sources</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">settings_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">],</span>
        <span class="n">init_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">env_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">dotenv_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
        <span class="n">file_secret_settings</span><span class="p">:</span> <span class="n">PydanticBaseSettingsSource</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PydanticBaseSettingsSource</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="c1"># here we choose to ignore arguments from init_settings</span>
        <span class="k">return</span> <span class="n">env_settings</span><span class="p">,</span> <span class="n">file_secret_settings</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">Settings</span><span class="p">(</span><span class="n">my_api_key</span><span class="o">=</span><span class="s1">&#39;this is ignored&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc_info</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for Settings</span>
<span class="sd">    my_api_key</span>
<span class="sd">      Field required [type=missing, input_value={}, input_type=dict]</span>
<span class="sd">        For further information visit https://errors.pydantic.dev/2/v/missing</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="_34">就地重载<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h2>
<p>如果你想就地重载现有设置，可以使用其 <code>__init__</code> 方法：</p>
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>


<span class="n">mutable_settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mutable_settings</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="c1">#&gt; foo</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mutable_settings</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="c1">#&gt; foo</span>

<span class="n">mutable_settings</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mutable_settings</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="c1">#&gt; bar</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">mutable_settings</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mutable_settings</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="c1">#&gt; foo</span>
</code></pre></div>







  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://github.com/oaixnah" target="_blank">译者 oaixnah</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "content.code.annotate", "content.code.copy", "announce.dismiss", "navigation.tabs", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.top", "navigation.tracking", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>