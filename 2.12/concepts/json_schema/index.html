
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pydantic JSON Schema 文档：学习如何从 Pydantic 模型自动生成和自定义 JSON Schema，包括字段级别和模型级别的自定义选项、TypeAdapter 使用、JSON Schema 模式配置、自定义类型处理以及完整的 JSON Schema 生成过程控制。符合 JSON Schema Draft 2020-12和OpenAPI Specification v3.1.0 标准。">
      
      
      
        <link rel="canonical" href="https://docs.pydantic.dev/latest/concepts/json_schema/">
      
      
        <link rel="prev" href="../fields/">
      
      
        <link rel="next" href="../json/">
      
      
      <link rel="icon" href="../../favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>JSON Schema - Pydantic Validation 中文文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra/terminal.css">
    
      <link rel="stylesheet" href="../../extra/tweaks.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#json" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Pydantic Validation 中文文档" class="md-header__button md-logo" aria-label="Pydantic Validation 中文文档" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydantic Validation 中文文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JSON Schema
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pydantic/pydantic" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  快速开始

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../models/" class="md-tabs__link">
          
  
  
  概念

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/base_model/" class="md-tabs__link">
          
  
  
  API 参考

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../internals/architecture/" class="md-tabs__link">
          
  
  
  内部实现

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/files/" class="md-tabs__link">
          
  
  
  示例

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../errors/errors/" class="md-tabs__link">
          
  
  
  错误信息

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../integrations/logfire/" class="md-tabs__link">
          
  
  
  集成

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pydantic Validation 中文文档" class="md-nav__button md-logo" aria-label="Pydantic Validation 中文文档" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    Pydantic Validation 中文文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pydantic/pydantic" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    快速开始
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            快速开始
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to Pydantic
    
      <br>
      <small>欢迎使用 Pydantic</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../why/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why use Pydantic
    
      <br>
      <small>为什么使用 Pydantic</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help_with_pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Help with Pydantic
    
      <br>
      <small>获取帮助</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
      <br>
      <small>安装</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration Guide
    
      <br>
      <small>迁移指南</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../version-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Version Policy
    
      <br>
      <small>版本策略</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
      <br>
      <small>贡献</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    概念
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            概念
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    JSON Schema
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    JSON Schema
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      生成 JSON 模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="生成 JSON 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonschemamode" class="md-nav__link">
    <span class="md-ellipsis">
      配置 JsonSchemaMode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON 模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 JSON 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field-level-customization" class="md-nav__link">
    <span class="md-ellipsis">
      字段级别自定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="字段级别自定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field" class="md-nav__link">
    <span class="md-ellipsis">
      未强制执行的 Field 约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      编程式字段标题生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-level-customization" class="md-nav__link">
    <span class="md-ellipsis">
      模型级自定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-json_schema_extra" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 json_schema_extra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json_schema_extra-dict" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra 与 dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_schema_extra-callable" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra 与 Callable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-json_schema_extra" class="md-nav__link">
    <span class="md-ellipsis">
      Merging json_schema_extra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withjsonschema-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      WithJsonSchema 注解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skipjsonschema-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      SkipJsonSchema 注解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing_get_pydantic_core_schema" class="md-nav__link">
    <span class="md-ellipsis">
      实现 __get_pydantic_core_schema__ 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing_get_pydantic_json_schema" class="md-nav__link">
    <span class="md-ellipsis">
      实现 __get_pydantic_json_schema__ 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field_title_generator" class="md-nav__link">
    <span class="md-ellipsis">
      使用 field_title_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model_title_generator" class="md-nav__link">
    <span class="md-ellipsis">
      使用 model_title_generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON Schema 类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema_1" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 类型映射优先级
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      顶层模式生成
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-the-json-schema-generation-process" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON Schema 生成过程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 JSON Schema 生成过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema_2" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 排序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema-ref" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON Schema 中的 $ref
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema_3" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 生成的杂项说明
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serialization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../forward_annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forward Annotations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strict_mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strict Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../type_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Type Adapter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation_decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Decorator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conversion_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conversion Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experimental/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experimental
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API 参考
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API 参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Pydantic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/base_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BaseModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/root_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RootModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/type_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TypeAdapter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/validate_call/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validate Call
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/aliases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aliases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/json_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Errors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/functional_validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Validators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/functional_serializers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Serializers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/standard_library_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Standard Library Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Version Information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/annotated_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Annotated Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/experimental/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experimental
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Pydantic Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic_core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_core_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic_core.core_schema
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pydantic Extra Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Pydantic Extra Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_color/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Color
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_country/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Country
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_payment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_phone_numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phone Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_routing_numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_coordinate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coordinate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_mac_address/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac Address
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_isbn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ISBN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_pendulum_dt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pendulum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_currency_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Currency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_language_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_script_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Script Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_semantic_version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Semantic Version
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pydantic_extra_types_timezone_name/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timezone Name
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    内部实现
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            内部实现
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internals/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
      <br>
      <small>架构</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internals/resolving_annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resolving Annotations
    
      <br>
      <small>解析注解</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    示例
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            示例
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validating File Data
    
      <br>
      <small>验证文件数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web and API Requests
    
      <br>
      <small>验证 HTTP 请求数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/queues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queues
    
      <br>
      <small>验证队列数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/orms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Databases
    
      <br>
      <small>验证 ORM 数据</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/custom_validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Validators
    
      <br>
      <small>自定义验证器</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    错误信息
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            错误信息
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling
    
      <br>
      <small>错误处理</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/validation_errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Errors
    
      <br>
      <small>验证错误</small>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/usage_errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Errors
    
      <br>
      <small>使用错误</small>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    集成
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            集成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/logfire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic Logfire
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/llms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    开发工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            开发工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/mypy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mypy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pyrefly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyrefly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pycharm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyCharm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/hypothesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hypothesis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/visual_studio_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visual Studio Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/datamodel_code_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datamodel-code-generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/devtools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    devtools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/rich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rich
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/linting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    生产工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            生产工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/aws_lambda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Lambda
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      生成 JSON 模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="生成 JSON 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonschemamode" class="md-nav__link">
    <span class="md-ellipsis">
      配置 JsonSchemaMode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON 模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 JSON 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field-level-customization" class="md-nav__link">
    <span class="md-ellipsis">
      字段级别自定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="字段级别自定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field" class="md-nav__link">
    <span class="md-ellipsis">
      未强制执行的 Field 约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      编程式字段标题生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-level-customization" class="md-nav__link">
    <span class="md-ellipsis">
      模型级自定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-json_schema_extra" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 json_schema_extra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json_schema_extra-dict" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra 与 dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_schema_extra-callable" class="md-nav__link">
    <span class="md-ellipsis">
      使用 json_schema_extra 与 Callable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-json_schema_extra" class="md-nav__link">
    <span class="md-ellipsis">
      Merging json_schema_extra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withjsonschema-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      WithJsonSchema 注解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skipjsonschema-annotation" class="md-nav__link">
    <span class="md-ellipsis">
      SkipJsonSchema 注解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing_get_pydantic_core_schema" class="md-nav__link">
    <span class="md-ellipsis">
      实现 __get_pydantic_core_schema__ 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing_get_pydantic_json_schema" class="md-nav__link">
    <span class="md-ellipsis">
      实现 __get_pydantic_json_schema__ 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field_title_generator" class="md-nav__link">
    <span class="md-ellipsis">
      使用 field_title_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model_title_generator" class="md-nav__link">
    <span class="md-ellipsis">
      使用 model_title_generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON Schema 类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema_1" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 类型映射优先级
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      顶层模式生成
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-the-json-schema-generation-process" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON Schema 生成过程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义 JSON Schema 生成过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema_2" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 排序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema-ref" class="md-nav__link">
    <span class="md-ellipsis">
      自定义 JSON Schema 中的 $ref
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-schema_3" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema 生成的杂项说明
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>JSON Schema</h1>

<details class="api">
<summary>API 文档</summary>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema"><code>pydantic.json_schema</code></a><br></p>
</details>
<p>Pydantic 允许从模型自动创建和自定义 JSON 模式。
生成的 JSON 模式符合以下规范：</p>
<ul>
<li><a href="https://json-schema.org/draft/2020-12/release-notes.html">JSON Schema Draft 2020-12</a></li>
<li><a href="https://github.com/OAI/OpenAPI-Specification">OpenAPI Specification v3.1.0</a></li>
</ul>
<h2 id="json">生成 JSON 模式<a class="headerlink" href="#json" title="Permanent link">&para;</a></h2>
<p>使用以下函数生成 JSON 模式：</p>
<ul>
<li><a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>BaseModel.model_json_schema</code></a> 返回模型模式的可 JSON 化字典</li>
<li><a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter.json_schema"><code>TypeAdapter.json_schema</code></a> 返回适配类型的可 JSON 化字典</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这些方法不要与 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_dump_json"><code>BaseModel.model_dump_json</code></a>
和 <a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter.dump_json"><code>TypeAdapter.dump_json</code></a> 混淆，后者分别序列化模型或适配类型的实例。
这些方法返回 JSON 字符串。相比之下，
<a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>BaseModel.model_json_schema</code></a> 和
<a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter.json_schema"><code>TypeAdapter.json_schema</code></a> 返回表示模型或适配类型 JSON 模式的可 JSON 化字典。</p>
</div>
<div class="admonition note">
<p class="admonition-title">关于 JSON 模式的"可 JSON 化"特性</p>
<p>关于 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>model_json_schema</code></a> 结果的"可 JSON 化"特性，
在某些 <code>BaseModel</code> <code>m</code> 上调用 <code>json.dumps(m.model_json_schema())</code> 会返回有效的 JSON 字符串。类似地，对于
<a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter.json_schema"><code>TypeAdapter.json_schema</code></a>，调用
<code>json.dumps(TypeAdapter(&lt;some_type&gt;).json_schema())</code> 也会返回有效的 JSON 字符串。</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Pydantic 提供对以下两者的支持：</p>
<ol>
<li><a href="#customizing-json-schema">自定义 JSON 模式</a></li>
<li><a href="#customizing-the-json-schema-generation-process">自定义 JSON 模式生成过程</a></li>
</ol>
<p>第一种方法通常范围较窄，允许为更具体的用例和类型自定义 JSON 模式。
第二种方法通常范围更广，允许自定义整个 JSON 模式生成过程。
两种方法都可以实现相同的效果，但根据您的用例，一种方法可能比另一种提供更简单的解决方案。</p>
</div>
<p>以下是从 <code>BaseModel</code> 生成 JSON 模式的示例：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Python 3.9 and above</label><label for="__tabbed_1_2">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FooBar</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Gender</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">male</span> <span class="o">=</span> <span class="s1">&#39;male&#39;</span>
    <span class="n">female</span> <span class="o">=</span> <span class="s1">&#39;female&#39;</span>
    <span class="n">other</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
    <span class="n">not_given</span> <span class="o">=</span> <span class="s1">&#39;not_given&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MainModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the description of the main model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Main&#39;</span><span class="p">)</span>

    <span class="n">foo_bar</span><span class="p">:</span> <span class="n">FooBar</span>
    <span class="n">gender</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Gender</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;Gender&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">snap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;The Snap&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;this is the value of snap&#39;</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">lt</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">main_model_schema</span> <span class="o">=</span> <span class="n">MainModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>  <span class="c1"># (1)!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">main_model_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># (2)!</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$defs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;FooBar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;null&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Size&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;count&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;male&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;female&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;other&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;not_given&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is the description of the main model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;foo_bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/FooBar&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/Gender&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;null&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;snap&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;this is the value of snap&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;exclusiveMaximum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;exclusiveMinimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Snap&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;foo_bar&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Main&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>这会生成 <code>MainModel</code> 模式的"可 JSON 化"字典。</li>
<li>在模式字典上调用 <code>json.dumps</code> 会生成 JSON 字符串。</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FooBar</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Gender</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">male</span> <span class="o">=</span> <span class="s1">&#39;male&#39;</span>
    <span class="n">female</span> <span class="o">=</span> <span class="s1">&#39;female&#39;</span>
    <span class="n">other</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
    <span class="n">not_given</span> <span class="o">=</span> <span class="s1">&#39;not_given&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MainModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the description of the main model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Main&#39;</span><span class="p">)</span>

    <span class="n">foo_bar</span><span class="p">:</span> <span class="n">FooBar</span>
    <span class="n">gender</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Gender</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s1">&#39;Gender&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">snap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;The Snap&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;this is the value of snap&#39;</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">lt</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">main_model_schema</span> <span class="o">=</span> <span class="n">MainModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>  <span class="c1"># (1)!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">main_model_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># (2)!</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$defs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;FooBar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;null&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Size&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;count&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;male&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;female&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;other&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;not_given&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is the description of the main model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;foo_bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/FooBar&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/Gender&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;null&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;snap&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;this is the value of snap&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;exclusiveMaximum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;exclusiveMinimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Snap&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;foo_bar&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Main&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>这会生成 <code>MainModel</code> 模式的"可 JSON 化"字典。</li>
<li>在模式字典上调用 <code>json.dumps</code> 会生成 JSON 字符串。</li>
</ol>
</div>
</div>
</div>
<p><a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter"><code>TypeAdapter</code></a> 类允许您创建一个对象，该对象具有验证、序列化和为任意类型生成 JSON 模式的方法。
这完全替代了 Pydantic V1 中的 <code>schema_of</code>（现已弃用）。</p>
<p>以下是从 <a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter"><code>TypeAdapter</code></a> 生成 JSON 模式的示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAdapter</span>

<span class="n">adapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adapter</span><span class="o">.</span><span class="n">json_schema</span><span class="p">())</span>
<span class="c1">#&gt; {&#39;items&#39;: {&#39;type&#39;: &#39;integer&#39;}, &#39;type&#39;: &#39;array&#39;}</span>
</code></pre></div>
<p>您还可以为 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel"><code>BaseModel</code>s</a> 和 <a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter"><code>TypeAdapter</code>s</a> 的组合生成 JSON 模式，
如以下示例所示：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">TypeAdapter</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Cat</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Dog</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">breed</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Union</span><span class="p">[</span><span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">])</span>
<span class="n">ta_schema</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ta_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$defs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Color&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;color&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cat&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Dog&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Breed&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;breed&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dog&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/Cat&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/Dog&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="jsonschemamode">配置 <code>JsonSchemaMode</code><a class="headerlink" href="#jsonschemamode" title="Permanent link">&para;</a></h3>
<p>通过 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>model_json_schema</code></a> 和
<a class="autorefs autorefs-internal" href="../../api/type_adapter/#pydantic.type_adapter.TypeAdapter.json_schema"><code>TypeAdapter.json_schema</code></a> 方法中的 <code>mode</code> 参数指定 JSON 模式生成模式。
默认情况下，模式设置为 <code>'validation'</code>，这会生成与模型验证模式对应的 JSON 模式。</p>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.JsonSchemaMode"><code>JsonSchemaMode</code></a> 是一个类型别名，表示 <code>mode</code> 参数的可用选项：</p>
<ul>
<li><code>'validation'</code></li>
<li><code>'serialization'</code></li>
</ul>
<p>以下是如何指定 <code>mode</code> 参数以及它如何影响生成的 JSON 模式的示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;12.34&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;a&#39;: {</span>
<span class="sd">            &#39;anyOf&#39;: [</span>
<span class="sd">                {&#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;pattern&#39;: &#39;^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$&#39;,</span>
<span class="sd">                    &#39;type&#39;: &#39;string&#39;,</span>
<span class="sd">                },</span>
<span class="sd">            ],</span>
<span class="sd">            &#39;default&#39;: &#39;12.34&#39;,</span>
<span class="sd">            &#39;title&#39;: &#39;A&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;title&#39;: &#39;Model&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;a&#39;: {</span>
<span class="sd">            &#39;default&#39;: &#39;12.34&#39;,</span>
<span class="sd">            &#39;pattern&#39;: &#39;^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$&#39;,</span>
<span class="sd">            &#39;title&#39;: &#39;A&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;string&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;title&#39;: &#39;Model&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="customizing-json-schema">自定义 JSON 模式<a class="headerlink" href="#customizing-json-schema" title="Permanent link">&para;</a></h2>
<p>生成的 JSON 模式可以通过以下方式在字段级别和模型级别进行自定义：</p>
<ol>
<li><a href="#field-level-customization">字段级别自定义</a> 使用 <a class="autorefs autorefs-internal" href="../../api/fields/#pydantic.fields.Field"><code>Field</code></a> 构造函数</li>
<li><a href="#model-level-customization">模型级别自定义</a> 使用 <a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict"><code>model_config</code></a></li>
</ol>
<p>在字段和模型级别，您都可以使用 <code>json_schema_extra</code> 选项向 JSON 模式添加额外信息。
下面的 <a href="#using-json_schema_extra">使用 <code>json_schema_extra</code></a> 部分提供了有关此选项的更多详细信息。</p>
<p>对于自定义类型，Pydantic 提供了其他用于自定义 JSON 模式生成的工具：</p>
<ol>
<li><a href="#withjsonschema-annotation"><code>WithJsonSchema</code> 注解</a></li>
<li><a href="#skipjsonschema-annotation"><code>SkipJsonSchema</code> 注解</a></li>
<li><a href="#implementing_get_pydantic_core_schema">实现 <code>__get_pydantic_core_schema__</code></a></li>
<li><a href="#implementing_get_pydantic_json_schema">实现 <code>__get_pydantic_json_schema__</code></a></li>
</ol>
<h3 id="field-level-customization">字段级别自定义<a class="headerlink" href="#field-level-customization" title="Permanent link">&para;</a></h3>
<p>可选地，可以使用 <a class="autorefs autorefs-internal" href="../../api/fields/#pydantic.fields.Field"><code>Field</code></a> 函数提供有关字段和验证的额外信息。</p>
<p>一些字段参数专门用于自定义生成的 JSON 模式：</p>
<ul>
<li><code>title</code>: 字段的标题</li>
<li><code>description</code>: 字段的描述</li>
<li><code>examples</code>: 字段的示例</li>
<li><code>json_schema_extra</code>: 要添加到字段的额外 JSON 模式属性</li>
<li><code>field_title_generator</code>: 根据字段名称和信息以编程方式设置字段标题的函数</li>
</ul>
<p>以下是一个示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">EmailStr</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">SecretStr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Age of the user&#39;</span><span class="p">)</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;marcelo@mail.com&#39;</span><span class="p">])</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Username&#39;</span><span class="p">)</span>
    <span class="n">password</span><span class="p">:</span> <span class="n">SecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Password of the user&#39;</span><span class="p">,</span>
            <span class="s1">&#39;examples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;123456&#39;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Age of the user&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;marcelo@mail.com&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Email&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Username&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Password of the user&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;123456&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Password&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;writeOnly&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;age&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;password&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="field">未强制执行的 <code>Field</code> 约束<a class="headerlink" href="#field" title="Permanent link">&para;</a></h4>
<p>如果 Pydantic 发现未强制执行的约束，将引发错误。如果您希望约束出现在模式中，即使解析时未检查，
可以使用带有原始模式属性名称的 <a class="autorefs autorefs-internal" href="../../api/fields/#pydantic.fields.Field"><code>Field</code></a> 的可变参数：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">PositiveInt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># 这不会起作用，因为 `PositiveInt` 优先于 `Field` 中定义的约束，意味着它们被忽略</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
        <span class="n">foo</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">lt</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="c1"># 如果您需要这样做，另一种方法是在 `Field` 中声明约束（或者可以使用 `conint()`）</span>
<span class="c1"># 这里两个约束都将被强制执行：</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ModelB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># 这里两个约束都将被应用，模式将正确生成</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">ModelB</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;foo&#39;: {</span>
<span class="sd">            &#39;exclusiveMaximum&#39;: 10,</span>
<span class="sd">            &#39;exclusiveMinimum&#39;: 0,</span>
<span class="sd">            &#39;title&#39;: &#39;Foo&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;integer&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;foo&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;ModelB&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>您也可以通过 <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/typing.html#typing.Annotated"><code>typing.Annotated</code></a> 使用 <a class="autorefs autorefs-internal" href="../../api/fields/#pydantic.fields.Field"><code>Field</code></a> 构造函数指定 JSON 模式修改：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">)]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="s1">&#39;Bar&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CustomName&#39;</span>
    <span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bar&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;maxLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CustomName&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_1">编程式字段标题生成<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p><code>field_title_generator</code> 参数可用于根据字段名称和信息以编程方式生成字段标题。</p>
<p>请参阅以下示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldInfo</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_title</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field_info</span><span class="p">:</span> <span class="n">FieldInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">field_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">field_title_generator</span><span class="o">=</span><span class="n">make_title</span><span class="p">)</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">field_title_generator</span><span class="o">=</span><span class="n">make_title</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;properties&quot;: {</span>
<span class="sd">    &quot;name&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;NAME&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;age&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;AGE&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;integer&quot;</span>
<span class="sd">    }</span>
<span class="sd">  },</span>
<span class="sd">  &quot;required&quot;: [</span>
<span class="sd">    &quot;name&quot;,</span>
<span class="sd">    &quot;age&quot;</span>
<span class="sd">  ],</span>
<span class="sd">  &quot;title&quot;: &quot;Person&quot;,</span>
<span class="sd">  &quot;type&quot;: &quot;object&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="model-level-customization">模型级自定义<a class="headerlink" href="#model-level-customization" title="Permanent link">&para;</a></h3>
<p>您还可以使用<a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict">模型配置</a>在模型级别自定义 JSON 模式生成。
具体来说，以下配置选项相关：</p>
<ul>
<li><a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict.title"><code>title</code></a></li>
<li><a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict.json_schema_extra"><code>json_schema_extra</code></a></li>
<li><a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict.json_schema_mode_override"><code>json_schema_mode_override</code></a></li>
<li><a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict.field_title_generator"><code>field_title_generator</code></a></li>
<li><a class="autorefs autorefs-internal" href="../../api/config/#pydantic.config.ConfigDict.model_title_generator"><code>model_title_generator</code></a></li>
</ul>
<h3 id="using-json_schema_extra">使用 <code>json_schema_extra</code><a class="headerlink" href="#using-json_schema_extra" title="Permanent link">&para;</a></h3>
<p><code>json_schema_extra</code> 选项可用于向 JSON 模式添加额外信息，可以在
<a href="#field-level-customization">字段级别</a> 或 <a href="#model-level-customization">模型级别</a>。
您可以传递一个 <code>dict</code> 或 <code>Callable</code> 给 <code>json_schema_extra</code>。</p>
<h4 id="json_schema_extra-dict">使用 <code>json_schema_extra</code> 与 <code>dict</code><a class="headerlink" href="#json_schema_extra-dict" title="Permanent link">&para;</a></h4>
<p>您可以传递一个 <code>dict</code> 给 <code>json_schema_extra</code> 来向 JSON 模式添加额外信息：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;examples&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;Foo&#39;</span><span class="p">}]})</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;a&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="json_schema_extra-callable">使用 <code>json_schema_extra</code> 与 <code>Callable</code><a class="headerlink" href="#json_schema_extra-callable" title="Permanent link">&para;</a></h4>
<p>您可以传递一个 <code>Callable</code> 给 <code>json_schema_extra</code>，通过函数修改 JSON 模式：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pop_default</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">json_schema_extra</span><span class="o">=</span><span class="n">pop_default</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="merging-json_schema_extra">Merging <code>json_schema_extra</code><a class="headerlink" href="#merging-json_schema_extra" title="Permanent link">&para;</a></h4>
<p>自 v2.9 起，Pydantic 会合并来自注解类型的 <code>json_schema_extra</code> 字典。
这种模式提供了一种更增量的合并方法，而不是之前的覆盖行为。
这对于在多个类型中重用 JSON 模式额外信息的情况非常有帮助。</p>
<p>我们主要将此更改视为错误修复，因为它解决了 <code>BaseModel</code> 和 <code>TypeAdapter</code> 实例之间 <code>json_schema_extra</code> 合并行为的意外差异 - 有关更多详细信息，请参阅<a href="https://github.com/pydantic/pydantic/issues/9210">此问题</a>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Python 3.9 and above</label><label for="__tabbed_2_2">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAlias</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">TypeAdapter</span>

<span class="n">ExternalType</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">})</span>
<span class="p">]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span>
    <span class="n">Annotated</span><span class="p">[</span><span class="n">ExternalType</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">})]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;key1&quot;: &quot;value1&quot;,</span>
<span class="sd">  &quot;key2&quot;: &quot;value2&quot;,</span>
<span class="sd">  &quot;type&quot;: &quot;integer&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAlias</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">TypeAdapter</span>

<span class="n">ExternalType</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">})</span>
<span class="p">]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span>
    <span class="n">Annotated</span><span class="p">[</span><span class="n">ExternalType</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">})]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;key1&quot;: &quot;value1&quot;,</span>
<span class="sd">  &quot;key2&quot;: &quot;value2&quot;,</span>
<span class="sd">  &quot;type&quot;: &quot;integer&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>我们不再（也从未完全）支持组合 <code>dict</code> 和 <code>callable</code> 类型的 <code>json_schema_extra</code> 规范。
如果这对您的用例是必需的，请<a href="https://github.com/pydantic/pydantic/issues/new/choose">打开一个 pydantic issue</a> 并解释您的情况 - 当我们看到有说服力的案例时，我们很乐意重新考虑这个决定。</p>
</div>
<h3 id="withjsonschema-annotation"><code>WithJsonSchema</code> 注解<a class="headerlink" href="#withjsonschema-annotation" title="Permanent link">&para;</a></h3>
<details class="api">
<summary>API 文档</summary>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.WithJsonSchema"><code>pydantic.json_schema.WithJsonSchema</code></a><br></p>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>对于自定义类型，使用 <a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.WithJsonSchema"><code>WithJsonSchema</code></a> 比
<a href="#implementing_get_pydantic_json_schema">实现 <code>__get_pydantic_json_schema__</code></a> 更受推荐，
因为它更简单且更不容易出错。</p>
</div>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.WithJsonSchema"><code>WithJsonSchema</code></a> 注解可用于覆盖给定类型的生成（基础）
JSON 模式，而无需在类型本身上实现 <code>__get_pydantic_core_schema__</code>
或 <code>__get_pydantic_json_schema__</code>。请注意，这会覆盖字段的整个 JSON 模式生成过程
（在以下示例中，还需要提供 <code>'type'</code>）。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">WithJsonSchema</span>

<span class="n">MyInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span>
    <span class="n">WithJsonSchema</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;examples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]}),</span>
<span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">MyInt</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="mi">-1</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;a&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>您可能会想使用 <a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.WithJsonSchema"><code>WithJsonSchema</code></a> 注解
来微调带有<a href="../validators/">验证器</a>的字段的 JSON Schema。相反，
建议使用 <a href="../validators/#json-schema-and-field-validators"><code>json_schema_input_type</code> 参数</a>。</p>
</div>
<h3 id="skipjsonschema-annotation"><code>SkipJsonSchema</code> 注解<a class="headerlink" href="#skipjsonschema-annotation" title="Permanent link">&para;</a></h3>
<details class="api">
<summary>API 文档</summary>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.SkipJsonSchema"><code>pydantic.json_schema.SkipJsonSchema</code></a><br></p>
</details>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.SkipJsonSchema"><code>SkipJsonSchema</code></a> 注解可用于跳过生成包含字段（或字段规范的一部分）的 JSON 模式。
有关更多详细信息，请参阅 API 文档。</p>
<h3 id="implementing_get_pydantic_core_schema">实现 <code>__get_pydantic_core_schema__</code> 方法<a class="headerlink" href="#implementing_get_pydantic_core_schema" title="Permanent link">&para;</a></h3>
<p>自定义类型（用作 <code>field_name: TheType</code> 或 <code>field_name: Annotated[TheType, ...]</code>）以及 <code>Annotated</code> 元数据
（用作 <code>field_name: Annotated[int, SomeMetadata]</code>）
可以通过实现 <code>__get_pydantic_core_schema__</code> 来修改或覆盖生成的模式。
此方法接收两个位置参数：</p>
<ol>
<li>与此类型对应的类型注解（例如，对于 <code>TheType[T][int]</code>，它将是 <code>TheType[int]</code>）。</li>
<li>一个处理程序/回调函数，用于调用 <code>__get_pydantic_core_schema__</code> 的下一个实现者。</li>
</ol>
<p>处理程序系统的工作方式类似于 <a href="../validators/#field-wrap-validator"><em>wrap</em> 字段验证器</a>。
在这种情况下，输入是类型，输出是一个 <code>core_schema</code>。</p>
<p>以下是一个自定义类型的示例，它<em>覆盖</em>了生成的 <code>core_schema</code>：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">GetCoreSchemaHandler</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CompressedString</span><span class="p">:</span>
    <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">source</span> <span class="ow">is</span> <span class="n">CompressedString</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_after_validator_function</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_validate</span><span class="p">,</span>
            <span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">(),</span>
            <span class="n">serialization</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">plain_serializer_function_ser_schema</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_serialize</span><span class="p">,</span>
                <span class="n">info_arg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">return_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">(),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;CompressedString&#39;</span><span class="p">:</span>
        <span class="n">inverse_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inverse_dictionary</span><span class="p">:</span>
                <span class="n">inverse_dictionary</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inverse_dictionary</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inverse_dictionary</span><span class="p">[</span><span class="n">word</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">CompressedString</span><span class="p">(</span>
            <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inverse_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">text</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="s1">&#39;CompressedString&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">CompressedString</span>


<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {&#39;value&#39;: {&#39;title&#39;: &#39;Value&#39;, &#39;type&#39;: &#39;string&#39;}},</span>
<span class="sd">    &#39;required&#39;: [&#39;value&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;MyModel&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;fox fox fox dog fox&#39;</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">value = CompressedString(dictionary={0: &#39;fox&#39;, 1: &#39;dog&#39;}, text=[0, 0, 0, 1, 0])</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;fox fox fox dog fox&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="c1">#&gt; {&#39;value&#39;: &#39;fox fox fox dog fox&#39;}</span>
</code></pre></div>
<p>由于 Pydantic 不知道如何为 <code>CompressedString</code> 生成模式，如果您在其 <code>__get_pydantic_core_schema__</code> 方法中调用 <code>handler(source)</code>，您将得到一个 <code>pydantic.errors.PydanticSchemaGenerationError</code> 错误。
对于大多数自定义类型来说都是这种情况，因此您几乎从不希望为自定义类型调用 <code>handler</code>。</p>
<p><code>Annotated</code> 元数据的过程大致相同，只是您通常可以调用 <code>handler</code> 让 Pydantic 处理模式生成。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">GetCoreSchemaHandler</span><span class="p">,</span> <span class="n">ValidationError</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RestrictCharacters</span><span class="p">:</span>
    <span class="n">alphabet</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Alphabet may not be empty&#39;</span><span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span>
            <span class="n">source</span>
        <span class="p">)</span>  <span class="c1"># get the CoreSchema from the type / inner constraints</span>
        <span class="k">if</span> <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;RestrictCharacters can only be applied to strings&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_after_validator_function</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span>
            <span class="n">schema</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s1"> is not restricted to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="si">!r}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RestrictCharacters</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">)]</span>


<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {&#39;value&#39;: {&#39;title&#39;: &#39;Value&#39;, &#39;type&#39;: &#39;string&#39;}},</span>
<span class="sd">    &#39;required&#39;: [&#39;value&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;MyModel&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;CBA&#39;</span><span class="p">))</span>
<span class="c1">#&gt; value=&#39;CBA&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">MyModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;XYZ&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for MyModel</span>
<span class="sd">    value</span>
<span class="sd">      Value error, &#39;XYZ&#39; is not restricted to &#39;ABC&#39; [type=value_error, input_value=&#39;XYZ&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<p>到目前为止，我们一直在包装模式，但如果您只想<em>修改</em>它或<em>忽略</em>它，也可以这样做。</p>
<p>要修改模式，首先调用处理程序，然后修改结果：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">GetCoreSchemaHandler</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SmallString</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span>
        <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;max_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 原地修改</span>
        <span class="k">return</span> <span class="n">schema</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SmallString</span><span class="p">()]</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">MyModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;too long!!!!!&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for MyModel</span>
<span class="sd">    value</span>
<span class="sd">      String should have at most 10 characters [type=string_too_long, input_value=&#39;too long!!!!!&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>请注意，您<em>必须</em>返回一个模式，即使您只是原地修改它。</p>
</div>
<p>要完全覆盖模式，不要调用处理程序，而是返回您自己的 <code>CoreSchema</code>：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">GetCoreSchemaHandler</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AllowAnySubclass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="c1"># 我们不能调用处理程序，因为它会因任意类型而失败</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Expected an instance of </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s1">, got an instance of </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_plain_validator_function</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">f</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Foo</span><span class="p">,</span> <span class="n">AllowAnySubclass</span><span class="p">()]</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">Foo</span><span class="p">()))</span>
<span class="c1">#&gt; f=None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">NotFoo</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">NotFoo</span><span class="p">())</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for Model</span>
<span class="sd">    f</span>
<span class="sd">      Value error, Expected an instance of &lt;class &#39;__main__.Foo&#39;&gt;, got an instance of &lt;class &#39;__main__.NotFoo&#39;&gt; [type=value_error, input_value=&lt;__main__.NotFoo object at 0x0123456789ab&gt;, input_type=NotFoo]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="implementing_get_pydantic_json_schema">实现 <code>__get_pydantic_json_schema__</code> 方法<a class="headerlink" href="#implementing_get_pydantic_json_schema" title="Permanent link">&para;</a></h3>
<p>您还可以实现 <code>__get_pydantic_json_schema__</code> 来修改或覆盖生成的 JSON 模式。
修改此方法仅影响 JSON 模式 - 它不影响用于验证和序列化的核心模式。</p>
<p>以下是修改生成的 JSON 模式的示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">core_schema</span> <span class="k">as</span> <span class="n">cs</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">GetCoreSchemaHandler</span><span class="p">,</span> <span class="n">GetJsonSchemaHandler</span><span class="p">,</span> <span class="n">TypeAdapter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cs</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cs</span><span class="o">.</span><span class="n">typed_dict_schema</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">cs</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">str_schema</span><span class="p">()),</span>
                <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">cs</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">int_schema</span><span class="p">()),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">core_schema</span><span class="p">:</span> <span class="n">cs</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="n">json_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">core_schema</span><span class="p">)</span>
        <span class="n">json_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">resolve_ref_schema</span><span class="p">(</span><span class="n">json_schema</span><span class="p">)</span>
        <span class="n">json_schema</span><span class="p">[</span><span class="s1">&#39;examples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
                <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="n">json_schema</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
        <span class="k">return</span> <span class="n">json_schema</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;examples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;age&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Person&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field_title_generator">使用 <code>field_title_generator</code><a class="headerlink" href="#field_title_generator" title="Permanent link">&para;</a></h3>
<p><code>field_title_generator</code> 参数可用于根据字段名称和信息以编程方式生成字段标题。
这类似于字段级别的 <code>field_title_generator</code>，但 <code>ConfigDict</code> 选项将应用于类的所有字段。</p>
<p>请参阅以下示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">field_title_generator</span><span class="o">=</span><span class="k">lambda</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_info</span><span class="p">:</span> <span class="n">field_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;properties&quot;: {</span>
<span class="sd">    &quot;name&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;NAME&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;age&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;AGE&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;integer&quot;</span>
<span class="sd">    }</span>
<span class="sd">  },</span>
<span class="sd">  &quot;required&quot;: [</span>
<span class="sd">    &quot;name&quot;,</span>
<span class="sd">    &quot;age&quot;</span>
<span class="sd">  ],</span>
<span class="sd">  &quot;title&quot;: &quot;Person&quot;,</span>
<span class="sd">  &quot;type&quot;: &quot;object&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="model_title_generator">使用 <code>model_title_generator</code><a class="headerlink" href="#model_title_generator" title="Permanent link">&para;</a></h3>
<p><code>model_title_generator</code> 配置选项类似于 <code>field_title_generator</code> 选项，但它应用于模型本身的标题，
并接受模型类作为输入。</p>
<p>请参阅以下示例：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_title</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Title-</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">model_title_generator</span><span class="o">=</span><span class="n">make_title</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>


<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;properties&quot;: {</span>
<span class="sd">    &quot;name&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;Name&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;age&quot;: {</span>
<span class="sd">      &quot;title&quot;: &quot;Age&quot;,</span>
<span class="sd">      &quot;type&quot;: &quot;integer&quot;</span>
<span class="sd">    }</span>
<span class="sd">  },</span>
<span class="sd">  &quot;required&quot;: [</span>
<span class="sd">    &quot;name&quot;,</span>
<span class="sd">    &quot;age&quot;</span>
<span class="sd">  ],</span>
<span class="sd">  &quot;title&quot;: &quot;Title-Person&quot;,</span>
<span class="sd">  &quot;type&quot;: &quot;object&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="json-schema">JSON Schema 类型<a class="headerlink" href="#json-schema" title="Permanent link">&para;</a></h2>
<p>类型、自定义字段类型和约束（如 <code>max_length</code>）按照以下优先级顺序映射到相应的规范格式（当有等效项可用时）：</p>
<ol>
<li><a href="https://json-schema.org/draft/2020-12/json-schema-core">JSON Schema Core</a></li>
<li><a href="https://json-schema.org/draft/2020-12/json-schema-validation">JSON Schema Validation</a></li>
<li><a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#data-types">OpenAPI Data Types</a></li>
<li>标准的 <code>format</code> JSON 字段用于为更复杂的 <code>string</code> 子类型定义 Pydantic 扩展。</li>
</ol>
<h3 id="json-schema_1">JSON Schema 类型映射优先级<a class="headerlink" href="#json-schema_1" title="Permanent link">&para;</a></h3>
<p>生成 JSON 模式时，Pydantic 使用以下优先级顺序来确定类型映射：</p>
<ol>
<li>具有 <code>__get_pydantic_json_schema__</code> 方法的自定义类型</li>
<li>具有 <code>WithJsonSchema</code> 注解的自定义类型</li>
<li>内置类型和标准库类型</li>
<li>泛型类型</li>
<li>联合类型</li>
<li>可选类型</li>
</ol>
<p>这意味着如果您有一个实现 <code>__get_pydantic_json_schema__</code> 的自定义类型，它将优先于内置类型映射。</p>
<p>从 Python 或 Pydantic 到 JSON 模式的字段模式映射如下：</p>
<table>
<thead>
<tr>
<th>Python type</th>
<th>JSON Schema Type</th>
<th>Additional JSON Schema</th>
<th>Defined in</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>null</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>Same for <code>type(None)</code> or <code>Literal[None]</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>boolean</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>str</code></td>
<td><code>string</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>number</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>integer</code></td>
<td></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>dict</code></td>
<td><code>object</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>list</code></td>
<td><code>array</code></td>
<td><code>{"items": {}}</code></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>tuple-positional</code></td>
<td><code>array</code></td>
<td><code>{"items": {}}</code></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>tuple-variable</code></td>
<td><code>array</code></td>
<td><code>{"items": {}}</code></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>set</code></td>
<td><code>array</code></td>
<td><code>{"uniqueItems": true, "items": {}}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>frozenset</code></td>
<td><code>array</code></td>
<td><code>{"uniqueItems": true, "items": {}}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>List[str]</code></td>
<td><code>array</code></td>
<td><code>{"items": {"type": "string"}}</code></td>
<td>JSON Schema Validation</td>
<td>And equivalently for any other sub type, e.g. <code>List[int]</code>.</td>
</tr>
<tr>
<td><code>Tuple[str, ...]</code></td>
<td><code>array</code></td>
<td><code>{"items": {"type": "string"}}</code></td>
<td>JSON Schema Validation</td>
<td>And equivalently for any other sub type, e.g. <code>Tuple[int, ...]</code>.</td>
</tr>
<tr>
<td><code>Tuple[str, int]</code></td>
<td><code>array</code></td>
<td><code>{"minItems": 2, "maxItems": 2, "items": [{"type": "string"}, {"type": "integer"}]}</code></td>
<td>JSON Schema Validation</td>
<td>And equivalently for any other set of subtypes. Note: If using schemas for OpenAPI, you shouldn't use this declaration, as it would not be valid in OpenAPI (although it is valid in JSON Schema).</td>
</tr>
<tr>
<td><code>Dict[str, int]</code></td>
<td><code>object</code></td>
<td><code>{"additionalProperties": {"type": "integer"}}</code></td>
<td>JSON Schema Validation</td>
<td>And equivalently for any other subfields for dicts. Have in mind that although you can use other types as keys for dicts with Pydantic, only strings are valid keys for JSON, and so, only str is valid as JSON Schema key types.</td>
</tr>
<tr>
<td><code>Union[str, int]</code></td>
<td><code>anyOf</code></td>
<td><code>{"anyOf": [{"type": "string"}, {"type": "integer"}]}</code></td>
<td>JSON Schema Validation</td>
<td>And equivalently for any other subfields for unions.</td>
</tr>
<tr>
<td><code>Enum</code></td>
<td><code>enum</code></td>
<td><code>{"enum": [...]}</code></td>
<td>JSON Schema Validation</td>
<td>All the literal values in the enum are included in the definition.</td>
</tr>
<tr>
<td><code>SecretStr</code></td>
<td><code>string</code></td>
<td><code>{"writeOnly": true}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>SecretBytes</code></td>
<td><code>string</code></td>
<td><code>{"writeOnly": true}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>EmailStr</code></td>
<td><code>string</code></td>
<td><code>{"format": "email"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NameEmail</code></td>
<td><code>string</code></td>
<td><code>{"format": "name-email"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>AnyUrl</code></td>
<td><code>string</code></td>
<td><code>{"format": "uri"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>Pattern</code></td>
<td><code>string</code></td>
<td><code>{"format": "regex"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>bytes</code></td>
<td><code>string</code></td>
<td><code>{"format": "binary"}</code></td>
<td>OpenAPI</td>
<td></td>
</tr>
<tr>
<td><code>Decimal</code></td>
<td><code>number</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>UUID1</code></td>
<td><code>string</code></td>
<td><code>{"format": "uuid1"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>UUID3</code></td>
<td><code>string</code></td>
<td><code>{"format": "uuid3"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>UUID4</code></td>
<td><code>string</code></td>
<td><code>{"format": "uuid4"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>UUID5</code></td>
<td><code>string</code></td>
<td><code>{"format": "uuid5"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>UUID</code></td>
<td><code>string</code></td>
<td><code>{"format": "uuid"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>Suggested in OpenAPI.</td>
</tr>
<tr>
<td><code>FilePath</code></td>
<td><code>string</code></td>
<td><code>{"format": "file-path"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>DirectoryPath</code></td>
<td><code>string</code></td>
<td><code>{"format": "directory-path"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>Path</code></td>
<td><code>string</code></td>
<td><code>{"format": "path"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>datetime</code></td>
<td><code>string</code></td>
<td><code>{"format": "date-time"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code>string</code></td>
<td><code>{"format": "date"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>time</code></td>
<td><code>string</code></td>
<td><code>{"format": "time"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>timedelta</code></td>
<td><code>number</code></td>
<td><code>{"format": "time-delta"}</code></td>
<td>Difference in seconds (a <code>float</code>), with Pydantic standard "format" extension</td>
<td>Suggested in JSON Schema repository's issues by maintainer.</td>
</tr>
<tr>
<td><code>Json</code></td>
<td><code>string</code></td>
<td><code>{"format": "json-string"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
<tr>
<td><code>IPv4Address</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv4"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>IPv6Address</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv6"}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>IPvAnyAddress</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipvanyaddress"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv4 or IPv6 address as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPv4Interface</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv4interface"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv4 interface as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPv6Interface</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv6interface"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv6 interface as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPvAnyInterface</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipvanyinterface"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv4 or IPv6 interface as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPv4Network</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv4network"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv4 network as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPv6Network</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipv6network"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv6 network as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>IPvAnyNetwork</code></td>
<td><code>string</code></td>
<td><code>{"format": "ipvanynetwork"}</code></td>
<td>Pydantic standard "format" extension</td>
<td>IPv4 or IPv6 network as used in <code>ipaddress</code> module</td>
</tr>
<tr>
<td><code>StrictBool</code></td>
<td><code>boolean</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>StrictStr</code></td>
<td><code>string</code></td>
<td></td>
<td>JSON Schema Core</td>
<td></td>
</tr>
<tr>
<td><code>ConstrainedStr</code></td>
<td><code>string</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>If the type has values declared for the constraints, they are included as validations. See the mapping for <code>constr</code> below.</td>
</tr>
<tr>
<td><code>constr(pattern='^text$', min_length=2, max_length=10)</code></td>
<td><code>string</code></td>
<td></td>
<td>JSON Schema Validation</td>
<td>Any argument not passed to the function (not defined) will not be included in the schema.</td>
</tr>
<tr>
<td><code>|</code></td>
<td><code>{"pattern": "^text$", "minLength": 2, "maxLength": 10}</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ConstrainedInt</code></td>
<td><code>integer</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>If the type has values declared for the constraints, they are included as validations. See the mapping for <code>conint</code> below.</td>
</tr>
<tr>
<td><code>conint(gt=1, ge=2, lt=6, le=5, multiple_of=2)</code></td>
<td><code>integer</code></td>
<td><code>{"maximum": 5, "exclusiveMaximum": 6, "minimum": 2, "exclusiveMinimum": 1, "multipleOf": 2}</code></td>
<td></td>
<td>Any argument not passed to the function (not defined) will not be included in the schema.</td>
</tr>
<tr>
<td><code>PositiveInt</code></td>
<td><code>integer</code></td>
<td><code>{"exclusiveMinimum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NegativeInt</code></td>
<td><code>integer</code></td>
<td><code>{"exclusiveMaximum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NonNegativeInt</code></td>
<td><code>integer</code></td>
<td><code>{"minimum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NonPositiveInt</code></td>
<td><code>integer</code></td>
<td><code>{"maximum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>ConstrainedFloat</code></td>
<td><code>number</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>If the type has values declared for the constraints, they are included as validations. See the mapping for <code>confloat</code> below.</td>
</tr>
<tr>
<td><code>confloat(gt=1, ge=2, lt=6, le=5, multiple_of=2)</code></td>
<td><code>number</code></td>
<td><code>{"maximum": 5, "exclusiveMaximum": 6, "minimum": 2, "exclusiveMinimum": 1, "multipleOf": 2}</code></td>
<td>JSON Schema Validation</td>
<td>Any argument not passed to the function (not defined) will not be included in the schema.</td>
</tr>
<tr>
<td><code>PositiveFloat</code></td>
<td><code>number</code></td>
<td><code>{"exclusiveMinimum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NegativeFloat</code></td>
<td><code>number</code></td>
<td><code>{"exclusiveMaximum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NonNegativeFloat</code></td>
<td><code>number</code></td>
<td><code>{"minimum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>NonPositiveFloat</code></td>
<td><code>number</code></td>
<td><code>{"maximum": 0}</code></td>
<td>JSON Schema Validation</td>
<td></td>
</tr>
<tr>
<td><code>ConstrainedDecimal</code></td>
<td><code>number</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>If the type has values declared for the constraints, they are included as validations. See the mapping for <code>condecimal</code> below.</td>
</tr>
<tr>
<td><code>condecimal(gt=1, ge=2, lt=6, le=5, multiple_of=2)</code></td>
<td><code>number</code></td>
<td><code>{"maximum": 5, "exclusiveMaximum": 6, "minimum": 2, "exclusiveMinimum": 1, "multipleOf": 2}</code></td>
<td>JSON Schema Validation</td>
<td>Any argument not passed to the function (not defined) will not be included in the schema.</td>
</tr>
<tr>
<td><code>BaseModel</code></td>
<td><code>object</code></td>
<td></td>
<td>JSON Schema Core</td>
<td>All the properties defined will be defined with standard JSON Schema, including submodels.</td>
</tr>
<tr>
<td><code>Color</code></td>
<td><code>string</code></td>
<td><code>{"format": "color"}</code></td>
<td>Pydantic standard "format" extension</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="_2">顶层模式生成<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>您还可以生成一个顶层 JSON 模式，该模式仅在其 <code>$defs</code> 中包含模型列表和相关子模型：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">models_json_schema</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Foo</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">_</span><span class="p">,</span> <span class="n">top_level_schema</span> <span class="o">=</span> <span class="n">models_json_schema</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">Model</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">)],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;My Schema&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">top_level_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$defs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;c&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bar&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Foo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/$defs/Foo&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;b&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My Schema&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="customizing-the-json-schema-generation-process">自定义 JSON Schema 生成过程<a class="headerlink" href="#customizing-the-json-schema-generation-process" title="Permanent link">&para;</a></h2>
<details class="api">
<summary>API 文档</summary>
<p><a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.GenerateJsonSchema"><code>pydantic.json_schema</code></a><br></p>
</details>
<p>如果您需要自定义模式生成，可以使用 <code>schema_generator</code>，根据需要修改
<a class="autorefs autorefs-internal" href="../../api/json_schema/#pydantic.json_schema.GenerateJsonSchema"><code>GenerateJsonSchema</code></a> 类以适应您的应用程序。</p>
<p>各种可用于生成 JSON 模式的方法都接受关键字参数 <code>schema_generator: type[GenerateJsonSchema] = GenerateJsonSchema</code>，您可以将自定义子类传递给这些方法，以使用您自己的 JSON 模式生成方法。</p>
<p><code>GenerateJsonSchema</code> 实现了将类型的 <code>pydantic-core</code> 模式转换为 JSON 模式的功能。
通过设计，该类将 JSON 模式生成过程分解为更小的方法，这些方法可以在子类中轻松重写，以修改生成 JSON 模式的"全局"方法。</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateJsonSchema</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyGenerateJsonSchema</span><span class="p">(</span><span class="n">GenerateJsonSchema</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">):</span>
        <span class="n">json_schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">json_schema</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Customize title&#39;</span>
        <span class="n">json_schema</span><span class="p">[</span><span class="s1">&#39;$schema&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_dialect</span>
        <span class="k">return</span> <span class="n">json_schema</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>


<span class="nb">print</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">schema_generator</span><span class="o">=</span><span class="n">MyGenerateJsonSchema</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {&#39;x&#39;: {&#39;title&#39;: &#39;X&#39;, &#39;type&#39;: &#39;integer&#39;}},</span>
<span class="sd">    &#39;required&#39;: [&#39;x&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Customize title&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">    &#39;$schema&#39;: &#39;https://json-schema.org/draft/2020-12/schema&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>Below is an approach you can use to exclude any fields from the schema that don't have valid json schemas:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Python 3.9 and above</label><label for="__tabbed_3_2">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">PydanticOmit</span><span class="p">,</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateJsonSchema</span><span class="p">,</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyGenerateJsonSchema</span><span class="p">(</span><span class="n">GenerateJsonSchema</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_invalid_for_json_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">error_info</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PydanticOmit</span>


<span class="k">def</span><span class="w"> </span><span class="nf">example_callable</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">example_callable</span>


<span class="n">instance_example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>

<span class="n">validation_schema</span> <span class="o">=</span> <span class="n">instance_example</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span>
    <span class="n">schema_generator</span><span class="o">=</span><span class="n">MyGenerateJsonSchema</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">validation_schema</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;name&#39;: {&#39;default&#39;: &#39;example&#39;, &#39;title&#39;: &#39;Name&#39;, &#39;type&#39;: &#39;string&#39;}</span>
<span class="sd">    },</span>
<span class="sd">    &#39;title&#39;: &#39;Example&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">PydanticOmit</span><span class="p">,</span> <span class="n">core_schema</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateJsonSchema</span><span class="p">,</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyGenerateJsonSchema</span><span class="p">(</span><span class="n">GenerateJsonSchema</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_invalid_for_json_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">error_info</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PydanticOmit</span>


<span class="k">def</span><span class="w"> </span><span class="nf">example_callable</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">example_callable</span>


<span class="n">instance_example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>

<span class="n">validation_schema</span> <span class="o">=</span> <span class="n">instance_example</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span>
    <span class="n">schema_generator</span><span class="o">=</span><span class="n">MyGenerateJsonSchema</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">validation_schema</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;name&#39;: {&#39;default&#39;: &#39;example&#39;, &#39;title&#39;: &#39;Name&#39;, &#39;type&#39;: &#39;string&#39;}</span>
<span class="sd">    },</span>
<span class="sd">    &#39;title&#39;: &#39;Example&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="json-schema_2">JSON Schema 排序<a class="headerlink" href="#json-schema_2" title="Permanent link">&para;</a></h3>
<p>默认情况下，Pydantic 通过按字母顺序排序键来递归排序 JSON 模式。值得注意的是，Pydantic 跳过对 <code>properties</code> 键值的排序，
以保留字段在模型中定义的顺序。</p>
<p>如果您想自定义此行为，可以在自定义的 <code>GenerateJsonSchema</code> 子类中重写 <code>sort</code> 方法。以下示例
使用无操作的 <code>sort</code> 方法完全禁用排序，这反映在模型字段和 <code>json_schema_extra</code> 键的保留顺序中：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Python 3.9 and above</label><label for="__tabbed_4_2">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateJsonSchema</span><span class="p">,</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyGenerateJsonSchema</span><span class="p">(</span><span class="n">GenerateJsonSchema</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">JsonSchemaValue</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No-op, we don&#39;t want to sort schema values at all.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">})</span>


<span class="n">json_schema</span> <span class="o">=</span> <span class="n">Bar</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">schema_generator</span><span class="o">=</span><span class="n">MyGenerateJsonSchema</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;type&quot;: &quot;object&quot;,</span>
<span class="sd">  &quot;properties&quot;: {</span>
<span class="sd">    &quot;c&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;C&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;b&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;B&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;a&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;c&quot;: &quot;hi&quot;,</span>
<span class="sd">      &quot;b&quot;: &quot;hello&quot;,</span>
<span class="sd">      &quot;a&quot;: &quot;world&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;A&quot;</span>
<span class="sd">    }</span>
<span class="sd">  },</span>
<span class="sd">  &quot;required&quot;: [</span>
<span class="sd">    &quot;c&quot;,</span>
<span class="sd">    &quot;b&quot;,</span>
<span class="sd">    &quot;a&quot;</span>
<span class="sd">  ],</span>
<span class="sd">  &quot;title&quot;: &quot;Bar&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.json_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateJsonSchema</span><span class="p">,</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyGenerateJsonSchema</span><span class="p">(</span><span class="n">GenerateJsonSchema</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">JsonSchemaValue</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No-op, we don&#39;t want to sort schema values at all.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">json_schema_extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">})</span>


<span class="n">json_schema</span> <span class="o">=</span> <span class="n">Bar</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">schema_generator</span><span class="o">=</span><span class="n">MyGenerateJsonSchema</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">  &quot;type&quot;: &quot;object&quot;,</span>
<span class="sd">  &quot;properties&quot;: {</span>
<span class="sd">    &quot;c&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;C&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;b&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;B&quot;</span>
<span class="sd">    },</span>
<span class="sd">    &quot;a&quot;: {</span>
<span class="sd">      &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">      &quot;c&quot;: &quot;hi&quot;,</span>
<span class="sd">      &quot;b&quot;: &quot;hello&quot;,</span>
<span class="sd">      &quot;a&quot;: &quot;world&quot;,</span>
<span class="sd">      &quot;title&quot;: &quot;A&quot;</span>
<span class="sd">    }</span>
<span class="sd">  },</span>
<span class="sd">  &quot;required&quot;: [</span>
<span class="sd">    &quot;c&quot;,</span>
<span class="sd">    &quot;b&quot;,</span>
<span class="sd">    &quot;a&quot;</span>
<span class="sd">  ],</span>
<span class="sd">  &quot;title&quot;: &quot;Bar&quot;</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="json-schema-ref">自定义 JSON Schema 中的 <code>$ref</code><a class="headerlink" href="#json-schema-ref" title="Permanent link">&para;</a></h2>
<p>可以通过调用 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>model_json_schema()</code></a>
或 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_dump_json"><code>model_dump_json()</code></a> 并传入 <code>ref_template</code> 关键字参数来更改 <code>$ref</code> 的格式。
定义始终存储在键 <code>$defs</code> 下，但可以为引用使用指定的前缀。</p>
<p>如果您需要扩展或修改 JSON 模式默认定义位置，这很有用。例如，对于 OpenAPI：</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic.type_adapter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAdapter</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">Foo</span>


<span class="n">adapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
        <span class="n">adapter</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(</span><span class="n">ref_template</span><span class="o">=</span><span class="s1">&#39;#/components/schemas/</span><span class="si">{model}</span><span class="s1">&#39;</span><span class="p">),</span>
        <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>JSON output:</p>
<div class="language-json highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$defs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Foo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;a&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Foo&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;$ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#/components/schemas/Foo&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;a&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="json-schema_3">JSON Schema 生成的杂项说明<a class="headerlink" href="#json-schema_3" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Optional</code> 字段的 JSON 模式表明允许值 <code>null</code>。</li>
<li><code>Decimal</code> 类型在 JSON 模式中（以及序列化时）以字符串形式暴露。</li>
<li>由于 JSON 中不存在 <code>namedtuple</code> 类型，模型的 JSON 模式不会将 <code>namedtuple</code> 保留为 <code>namedtuple</code>。</li>
<li>使用的子模型按照规范添加到 <code>$defs</code> JSON 属性中并被引用。</li>
<li>具有修改（通过 <code>Field</code> 类）的子模型，如自定义标题、描述或默认值，
    会被递归包含而不是被引用。</li>
<li>模型的 <code>description</code> 取自类的文档字符串或 <code>Field</code> 类的 <code>description</code> 参数。</li>
<li>默认情况下，模式使用别名作为键生成，但可以通过调用 <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_json_schema"><code>model_json_schema()</code></a> 或
    <a class="autorefs autorefs-internal" href="../../api/base_model/#pydantic.BaseModel.model_dump_json"><code>model_dump_json()</code></a> 并传入 <code>by_alias=False</code> 关键字参数，使用模型属性名称生成模式。</li>
</ul>







  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://github.com/oaixnah" target="_blank">译者 oaixnah</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "content.code.annotate", "content.code.copy", "announce.dismiss", "navigation.tabs", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.top", "navigation.tracking", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>